!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MyAiLib=t():e.MyAiLib=t()}(this,(()=>(()=>{"use strict";var e={699:e=>{const t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function n(e,n,o){null==o&&null!==n&&"object"==typeof n&&(o=n,n=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));const i=JSON.parse(e,n);if(null===i||"object"!=typeof i)return i;const l=o&&o.protoAction||"error",u=o&&o.constructorAction||"error";if("ignore"===l&&"ignore"===u)return i;if("ignore"!==l&&"ignore"!==u){if(!1===r.test(e)&&!1===a.test(e))return i}else if("ignore"!==l&&"ignore"===u){if(!1===r.test(e))return i}else if(!1===a.test(e))return i;return s(i,{protoAction:l,constructorAction:u,safe:o&&o.safe})}function s(e,{protoAction:t="error",constructorAction:r="error",safe:a}={}){let n=[e];for(;n.length;){const e=n;n=[];for(const s of e){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(s,"__proto__")){if(!0===a)return null;if("error"===t)throw new SyntaxError("Object contains forbidden prototype property");delete s.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(s,"constructor")&&Object.prototype.hasOwnProperty.call(s.constructor,"prototype")){if(!0===a)return null;if("error"===r)throw new SyntaxError("Object contains forbidden prototype property");delete s.constructor}for(const e in s){const t=s[e];t&&"object"==typeof t&&n.push(t)}}}return e}function o(e,t,r){const a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,r)}finally{Error.stackTraceLimit=a}}e.exports=o,e.exports.default=o,e.exports.parse=o,e.exports.safeParse=function(e,t){const r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=s}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,r),s.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};r.r(a),r.d(a,{createOpenRouter:()=>ya,generateText:()=>_l,streamText:()=>Pl});var n,s="vercel.ai.error",o=Symbol.for(s),i=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[n]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,s)}static hasMarker(e,t){const r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};n=o;var l,u=i,c="AI_APICallError",d=`vercel.ai.error.${c}`,p=Symbol.for(d),m=class extends u{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:n,responseBody:s,cause:o,isRetryable:i=null!=a&&(408===a||409===a||429===a||a>=500),data:u}){super({name:c,message:e,cause:o}),this[l]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=n,this.responseBody=s,this.isRetryable=i,this.data=u}static isInstance(e){return u.hasMarker(e,d)}};l=p;var h,f="AI_EmptyResponseBodyError",g=`vercel.ai.error.${f}`,y=Symbol.for(g),v=class extends u{constructor({message:e="Empty response body"}={}){super({name:f,message:e}),this[h]=!0}static isInstance(e){return u.hasMarker(e,g)}};function _(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}h=y;var b,x="AI_InvalidArgumentError",w=`vercel.ai.error.${x}`,k=Symbol.for(w),T=class extends u{constructor({message:e,cause:t,argument:r}){super({name:x,message:e,cause:t}),this[b]=!0,this.argument=r}static isInstance(e){return u.hasMarker(e,w)}};b=k;var S,I="AI_InvalidPromptError",E=`vercel.ai.error.${I}`,A=Symbol.for(E),C=class extends u{constructor({prompt:e,message:t,cause:r}){super({name:I,message:`Invalid prompt: ${t}`,cause:r}),this[S]=!0,this.prompt=e}static isInstance(e){return u.hasMarker(e,E)}};S=A;var R,N="AI_InvalidResponseDataError",O=`vercel.ai.error.${N}`,j=Symbol.for(O),P=class extends u{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:N,message:t}),this[R]=!0,this.data=e}static isInstance(e){return u.hasMarker(e,O)}};R=j;var M,$="AI_JSONParseError",Z=`vercel.ai.error.${$}`,D=Symbol.for(Z),F=class extends u{constructor({text:e,cause:t}){super({name:$,message:`JSON parsing failed: Text: ${e}.\nError message: ${_(t)}`,cause:t}),this[M]=!0,this.text=e}static isInstance(e){return u.hasMarker(e,Z)}};M=D;var q,L="AI_LoadAPIKeyError",U=`vercel.ai.error.${L}`,B=Symbol.for(U),V=class extends u{constructor({message:e}){super({name:L,message:e}),this[q]=!0}static isInstance(e){return u.hasMarker(e,U)}};q=B;Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var z,J="AI_TypeValidationError",K=`vercel.ai.error.${J}`,W=Symbol.for(K);z=W;var H,Y=class e extends u{constructor({value:e,cause:t}){super({name:J,message:`Type validation failed: Value: ${JSON.stringify(e)}.\nError message: ${_(t)}`,cause:t}),this[z]=!0,this.value=e}static isInstance(e){return u.hasMarker(e,K)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}},G="AI_UnsupportedFunctionalityError",X=`vercel.ai.error.${G}`,Q=Symbol.for(X),ee=class extends u{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:G,message:t}),this[H]=!0,this.functionality=e}static isInstance(e){return u.hasMarker(e,X)}};H=Q;let te=(e,t=21)=>(r=t)=>{let a="",n=0|r;for(;n--;)a+=e[Math.random()*e.length|0];return a};var re=r(699),ae=Object.defineProperty,ne=(e,t,r)=>((e,t,r)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class se extends Error{constructor(e,t){super(e),ne(this,"type"),ne(this,"field"),ne(this,"value"),ne(this,"line"),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function oe(e){}class ie extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let a;super({start(n){a=function(e){const{onEvent:t=oe,onError:r=oe,onRetry:a=oe,onComment:n}=e;let s,o="",i=!0,l="",u="";function c(e){if(""===e)return l.length>0&&t({id:s,event:u||void 0,data:l.endsWith("\n")?l.slice(0,-1):l}),s=void 0,l="",void(u="");if(e.startsWith(":"))return void(n&&n(e.slice(e.startsWith(": ")?2:1)));const r=e.indexOf(":");if(-1===r)d(e,"",e);else{const t=e.slice(0,r),a=" "===e[r+1]?2:1;d(t,e.slice(r+a),e)}}function d(e,t,n){switch(e){case"event":u=t;break;case"data":l=`${l}${t}\n`;break;case"id":s=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?a(parseInt(t,10)):r(new se(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:n}));break;default:r(new se(`Unknown field "${e.length>20?`${e.slice(0,20)}â€¦`:e}"`,{type:"unknown-field",field:e,value:t,line:n}))}}return{feed:function(e){const t=i?e.replace(/^\xEF\xBB\xBF/,""):e,[r,a]=function(e){const t=[];let r="";const a=e.length;for(let n=0;n<a;n++){const a=e[n];"\r"===a&&"\n"===e[n+1]?(t.push(r),r="",n++):"\r"===a||"\n"===a?(t.push(r),r=""):r+=a}return[t,r]}(`${o}${t}`);for(const e of r)c(e);o=a,i=!1},reset:function(e={}){o&&e.consume&&c(o),s=void 0,l="",u="",o=""}}}({onEvent:e=>{n.enqueue(e)},onError(t){"terminate"===e?n.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:r})},transform(e){a.feed(e)}})}}function le(...e){return e.reduce(((e,t)=>({...e,...null!=t?t:{}})),{})}function ue(e){const t={};return e.headers.forEach(((e,r)=>{t[r]=e})),t}var ce=(({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const n=te(r,t);if(null==e)return n;if(r.includes(a))throw new T({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${n(t)}`})();function de(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}function pe({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:a}){if("string"==typeof e)return e;if(null!=e)throw new V({message:`${a} API key must be a string.`});if("undefined"==typeof process)throw new V({message:`${a} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new V({message:`${a} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new V({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var me=Symbol.for("vercel.ai.validator");function he({value:e,schema:t}){const r=function(e){return function(e){return"object"==typeof e&&null!==e&&me in e&&!0===e[me]&&"validate"in e}(e)?e:function(e){return t=t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}},{[me]:!0,validate:t};var t}(e)}(t);try{if(null==r.validate)return{success:!0,value:e};const t=r.validate(e);return t.success?t:{success:!1,error:Y.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:Y.wrap({value:e,cause:t})}}}function fe({text:e,schema:t}){try{const r=re.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};const a=he({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(t){return{success:!1,error:F.isInstance(t)?t:new F({text:e,cause:t})}}}function ge(e){try{return re.parse(e),!0}catch(e){return!1}}var ye,ve,_e=()=>globalThis.fetch,be=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:o})=>xe({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:o}),xe=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:n,abortSignal:s,fetch:o=_e()})=>{try{const l=await o(e,{method:"POST",headers:(i=t,Object.fromEntries(Object.entries(i).filter((([e,t])=>null!=t)))),body:r.content,signal:s}),u=ue(l);if(!l.ok){let t;try{t=await n({response:l,url:e,requestBodyValues:r.values})}catch(t){if(de(t)||m.isInstance(t))throw t;throw new m({message:"Failed to process error response",cause:t,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:r.values})}throw t.value}try{return await a({response:l,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(de(t)||m.isInstance(t)))throw t;throw new m({message:"Failed to process successful response",cause:t,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:r.values})}}catch(t){if(de(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){const a=t.cause;if(null!=a)throw new m({message:`Cannot connect to API: ${a.message}`,cause:a,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}var i},we=e=>async({response:t})=>{const r=ue(t);if(null==t.body)throw new v({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new ie).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(fe({text:t,schema:e}))}}))}},ke=e=>async({response:t,url:r,requestBodyValues:a})=>{const n=await t.text(),s=fe({text:n,schema:e}),o=ue(t);if(!s.success)throw new m({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:o,responseBody:n,url:r,requestBodyValues:a});return{responseHeaders:o,value:s.value,rawValue:s.rawValue}},{btoa:Te,atob:Se}=globalThis;function Ie(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return Te(t)}!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),a={};for(const e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(ye||(ye={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(ve||(ve={}));const Ee=ye.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ae=e=>{switch(typeof e){case"undefined":return Ee.undefined;case"string":return Ee.string;case"number":return isNaN(e)?Ee.nan:Ee.number;case"boolean":return Ee.boolean;case"function":return Ee.function;case"bigint":return Ee.bigint;case"symbol":return Ee.symbol;case"object":return Array.isArray(e)?Ee.array:null===e?Ee.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Ee.promise:"undefined"!=typeof Map&&e instanceof Map?Ee.map:"undefined"!=typeof Set&&e instanceof Set?Ee.set:"undefined"!=typeof Date&&e instanceof Date?Ee.date:Ee.object;default:return Ee.unknown}},Ce=ye.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Re extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(a);else if("invalid_return_type"===n.code)a(n.returnTypeError);else if("invalid_arguments"===n.code)a(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,a=0;for(;a<n.path.length;){const r=n.path[a];a===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof Re))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ye.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},r=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Re.create=e=>new Re(e);const Ne=(e,t)=>{let r;switch(e.code){case Ce.invalid_type:r=e.received===Ee.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Ce.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,ye.jsonStringifyReplacer)}`;break;case Ce.unrecognized_keys:r=`Unrecognized key(s) in object: ${ye.joinValues(e.keys,", ")}`;break;case Ce.invalid_union:r="Invalid input";break;case Ce.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ye.joinValues(e.options)}`;break;case Ce.invalid_enum_value:r=`Invalid enum value. Expected ${ye.joinValues(e.options)}, received '${e.received}'`;break;case Ce.invalid_arguments:r="Invalid function arguments";break;case Ce.invalid_return_type:r="Invalid function return type";break;case Ce.invalid_date:r="Invalid date";break;case Ce.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:ye.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Ce.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Ce.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Ce.custom:r="Invalid input";break;case Ce.invalid_intersection_types:r="Intersection results could not be merged";break;case Ce.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Ce.not_finite:r="Number must be finite";break;default:r=t.defaultError,ye.assertNever(e)}return{message:r}};let Oe=Ne;function je(){return Oe}const Pe=e=>{const{data:t,path:r,errorMaps:a,issueData:n}=e,s=[...r,...n.path||[]],o={...n,path:s};if(void 0!==n.message)return{...n,path:s,message:n.message};let i="";const l=a.filter((e=>!!e)).slice().reverse();for(const e of l)i=e(o,{data:t,defaultError:i}).message;return{...n,path:s,message:i}};function Me(e,t){const r=je(),a=Pe({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===Ne?void 0:Ne].filter((e=>!!e))});e.common.issues.push(a)}class $e{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const a of t){if("aborted"===a.status)return Ze;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t){const t=await e.key,a=await e.value;r.push({key:t,value:a})}return $e.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const a of t){const{key:t,value:n}=a;if("aborted"===t.status)return Ze;if("aborted"===n.status)return Ze;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!a.alwaysSet||(r[t.value]=n.value)}return{status:e.value,value:r}}}const Ze=Object.freeze({status:"aborted"}),De=e=>({status:"dirty",value:e}),Fe=e=>({status:"valid",value:e}),qe=e=>"aborted"===e.status,Le=e=>"dirty"===e.status,Ue=e=>"valid"===e.status,Be=e=>"undefined"!=typeof Promise&&e instanceof Promise;function Ve(e,t,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function ze(e,t,r,a,n){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?n.call(e,r):n?n.value=r:t.set(e,r),r}var Je,Ke,We;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Je||(Je={}));class He{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ye=(e,t)=>{if(Ue(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Re(e.common.issues);return this._error=t,this._error}}};function Ge(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:a,description:n}=e;if(t&&(r||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{var s,o;const{message:i}=e;return"invalid_enum_value"===t.code?{message:null!=i?i:n.defaultError}:void 0===n.data?{message:null!==(s=null!=i?i:a)&&void 0!==s?s:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(o=null!=i?i:r)&&void 0!==o?o:n.defaultError}},description:n}}class Xe{get description(){return this._def.description}_getType(e){return Ae(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ae(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new $e,ctx:{common:e.parent.common,data:e.data,parsedType:Ae(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Be(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ae(e)},n=this._parseSync({data:e,path:a.path,parent:a});return Ye(a,n)}"~validate"(e){var t,r;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ae(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:a});return Ue(t)?{value:t.value}:{issues:a.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then((e=>Ue(e)?{value:e.value}:{issues:a.common.issues}))}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ae(e)},a=this._parse({data:e,path:r.path,parent:r}),n=await(Be(a)?a:Promise.resolve(a));return Ye(r,n)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,a)=>{const n=e(t),s=()=>a.addIssue({code:Ce.custom,...r(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then((e=>!!e||(s(),!1))):!!n||(s(),!1)}))}refinement(e,t){return this._refinement(((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1)))}_refinement(e){return new Xt({schema:this,typeName:dr.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Qt.create(this,this._def)}nullable(){return er.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jt.create(this)}promise(){return Gt.create(this,this._def)}or(e){return $t.create([this,e],this._def)}and(e){return qt.create(this,e,this._def)}transform(e){return new Xt({...Ge(this._def),schema:this,typeName:dr.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new tr({...Ge(this._def),innerType:this,defaultValue:t,typeName:dr.ZodDefault})}brand(){return new sr({typeName:dr.ZodBranded,type:this,...Ge(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new rr({...Ge(this._def),innerType:this,catchValue:t,typeName:dr.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return or.create(this,e)}readonly(){return ir.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Qe=/^c[^\s-]{8,}$/i,et=/^[0-9a-z]+$/,tt=/^[0-9A-HJKMNP-TV-Z]{26}$/i,rt=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,at=/^[a-z0-9_-]{21}$/i,nt=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,st=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ot=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let it;const lt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ut=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ct=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,dt=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,pt=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,mt=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ht="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ft=new RegExp(`^${ht}$`);function gt(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function yt(e){let t=`${ht}T${gt(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function vt(e,t){if(!nt.test(e))return!1;try{const[r]=e.split("."),a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));return!("object"!=typeof n||null===n||!n.typ||!n.alg||t&&n.alg!==t)}catch(e){return!1}}function _t(e,t){return!("v4"!==t&&t||!ut.test(e))||!("v6"!==t&&t||!dt.test(e))}class bt extends Xe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Ee.string){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.string,received:t.parsedType}),Ze}const t=new $e;let r;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const a=e.data.length>s.value,n=e.data.length<s.value;(a||n)&&(r=this._getOrReturnCtx(e,r),a?Me(r,{code:Ce.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):n&&Me(r,{code:Ce.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)ot.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"email",code:Ce.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)it||(it=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),it.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"emoji",code:Ce.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)rt.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"uuid",code:Ce.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)at.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"nanoid",code:Ce.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)Qe.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"cuid",code:Ce.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)et.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"cuid2",code:Ce.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)tt.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"ulid",code:Ce.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch(a){r=this._getOrReturnCtx(e,r),Me(r,{validation:"url",code:Ce.invalid_string,message:s.message}),t.dirty()}else"regex"===s.kind?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"regex",code:Ce.invalid_string,message:s.message}),t.dirty())):"trim"===s.kind?e.data=e.data.trim():"includes"===s.kind?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty()):"toLowerCase"===s.kind?e.data=e.data.toLowerCase():"toUpperCase"===s.kind?e.data=e.data.toUpperCase():"startsWith"===s.kind?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty()):"endsWith"===s.kind?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty()):"datetime"===s.kind?yt(s).test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.invalid_string,validation:"datetime",message:s.message}),t.dirty()):"date"===s.kind?ft.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.invalid_string,validation:"date",message:s.message}),t.dirty()):"time"===s.kind?new RegExp(`^${gt(s)}$`).test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.invalid_string,validation:"time",message:s.message}),t.dirty()):"duration"===s.kind?st.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"duration",code:Ce.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?(a=e.data,("v4"!==(n=s.version)&&n||!lt.test(a))&&("v6"!==n&&n||!ct.test(a))&&(r=this._getOrReturnCtx(e,r),Me(r,{validation:"ip",code:Ce.invalid_string,message:s.message}),t.dirty())):"jwt"===s.kind?vt(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"jwt",code:Ce.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?_t(e.data,s.version)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"cidr",code:Ce.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?pt.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"base64",code:Ce.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?mt.test(e.data)||(r=this._getOrReturnCtx(e,r),Me(r,{validation:"base64url",code:Ce.invalid_string,message:s.message}),t.dirty()):ye.assertNever(s);var a,n;return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:Ce.invalid_string,...Je.errToObj(r)})}_addCheck(e){return new bt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Je.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Je.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Je.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Je.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Je.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Je.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Je.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Je.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Je.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Je.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Je.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Je.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Je.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...Je.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...Je.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Je.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Je.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Je.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Je.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Je.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Je.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Je.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Je.errToObj(t)})}nonempty(e){return this.min(1,Je.errToObj(e))}trim(){return new bt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new bt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new bt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function xt(e,t){const r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}bt.create=e=>{var t;return new bt({checks:[],typeName:dr.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Ge(e)})};class wt extends Xe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Ee.number){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.number,received:t.parsedType}),Ze}let t;const r=new $e;for(const a of this._def.checks)"int"===a.kind?ye.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Me(t,{code:Ce.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Me(t,{code:Ce.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Me(t,{code:Ce.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==xt(e.data,a.value)&&(t=this._getOrReturnCtx(e,t),Me(t,{code:Ce.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Me(t,{code:Ce.not_finite,message:a.message}),r.dirty()):ye.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Je.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Je.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Je.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Je.toString(t))}setLimit(e,t,r,a){return new wt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Je.toString(a)}]})}_addCheck(e){return new wt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Je.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Je.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Je.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Je.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Je.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Je.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Je.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Je.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Je.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&ye.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}wt.create=e=>new wt({checks:[],typeName:dr.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Ge(e)});class kt extends Xe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==Ee.bigint)return this._getInvalidInput(e);let t;const r=new $e;for(const a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Me(t,{code:Ce.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Me(t,{code:Ce.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Me(t,{code:Ce.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):ye.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.bigint,received:t.parsedType}),Ze}gte(e,t){return this.setLimit("min",e,!0,Je.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Je.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Je.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Je.toString(t))}setLimit(e,t,r,a){return new kt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Je.toString(a)}]})}_addCheck(e){return new kt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Je.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Je.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Je.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Je.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Je.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}kt.create=e=>{var t;return new kt({checks:[],typeName:dr.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Ge(e)})};class Tt extends Xe{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==Ee.boolean){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.boolean,received:t.parsedType}),Ze}return Fe(e.data)}}Tt.create=e=>new Tt({typeName:dr.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Ge(e)});class St extends Xe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Ee.date){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.date,received:t.parsedType}),Ze}if(isNaN(e.data.getTime()))return Me(this._getOrReturnCtx(e),{code:Ce.invalid_date}),Ze;const t=new $e;let r;for(const a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(r=this._getOrReturnCtx(e,r),Me(r,{code:Ce.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):ye.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new St({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Je.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Je.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}St.create=e=>new St({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:dr.ZodDate,...Ge(e)});class It extends Xe{_parse(e){if(this._getType(e)!==Ee.symbol){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.symbol,received:t.parsedType}),Ze}return Fe(e.data)}}It.create=e=>new It({typeName:dr.ZodSymbol,...Ge(e)});class Et extends Xe{_parse(e){if(this._getType(e)!==Ee.undefined){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.undefined,received:t.parsedType}),Ze}return Fe(e.data)}}Et.create=e=>new Et({typeName:dr.ZodUndefined,...Ge(e)});class At extends Xe{_parse(e){if(this._getType(e)!==Ee.null){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.null,received:t.parsedType}),Ze}return Fe(e.data)}}At.create=e=>new At({typeName:dr.ZodNull,...Ge(e)});class Ct extends Xe{constructor(){super(...arguments),this._any=!0}_parse(e){return Fe(e.data)}}Ct.create=e=>new Ct({typeName:dr.ZodAny,...Ge(e)});class Rt extends Xe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Fe(e.data)}}Rt.create=e=>new Rt({typeName:dr.ZodUnknown,...Ge(e)});class Nt extends Xe{_parse(e){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.never,received:t.parsedType}),Ze}}Nt.create=e=>new Nt({typeName:dr.ZodNever,...Ge(e)});class Ot extends Xe{_parse(e){if(this._getType(e)!==Ee.undefined){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.void,received:t.parsedType}),Ze}return Fe(e.data)}}Ot.create=e=>new Ot({typeName:dr.ZodVoid,...Ge(e)});class jt extends Xe{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==Ee.array)return Me(t,{code:Ce.invalid_type,expected:Ee.array,received:t.parsedType}),Ze;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(Me(t,{code:e?Ce.too_big:Ce.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(Me(t,{code:Ce.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(Me(t,{code:Ce.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>a.type._parseAsync(new He(t,e,t.path,r))))).then((e=>$e.mergeArray(r,e)));const n=[...t.data].map(((e,r)=>a.type._parseSync(new He(t,e,t.path,r))));return $e.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new jt({...this._def,minLength:{value:e,message:Je.toString(t)}})}max(e,t){return new jt({...this._def,maxLength:{value:e,message:Je.toString(t)}})}length(e,t){return new jt({...this._def,exactLength:{value:e,message:Je.toString(t)}})}nonempty(e){return this.min(1,e)}}function Pt(e){if(e instanceof Mt){const t={};for(const r in e.shape){const a=e.shape[r];t[r]=Qt.create(Pt(a))}return new Mt({...e._def,shape:()=>t})}return e instanceof jt?new jt({...e._def,type:Pt(e.element)}):e instanceof Qt?Qt.create(Pt(e.unwrap())):e instanceof er?er.create(Pt(e.unwrap())):e instanceof Lt?Lt.create(e.items.map((e=>Pt(e)))):e}jt.create=(e,t)=>new jt({type:e,minLength:null,maxLength:null,exactLength:null,typeName:dr.ZodArray,...Ge(t)});class Mt extends Xe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=ye.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Ee.object){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.object,received:t.parsedType}),Ze}const{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof Nt&&"strip"===this._def.unknownKeys))for(const e in r.data)n.includes(e)||s.push(e);const o=[];for(const e of n){const t=a[e],n=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new He(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof Nt){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of s)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(Me(r,{code:Ce.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const a=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new He(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of o){const r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e})).then((e=>$e.mergeObjectSync(t,e))):$e.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return Je.errToObj,new Mt({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,n,s,o;const i=null!==(s=null===(n=(a=this._def).errorMap)||void 0===n?void 0:n.call(a,t,r).message)&&void 0!==s?s:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=Je.errToObj(e).message)&&void 0!==o?o:i}:{message:i}}}:{}})}strip(){return new Mt({...this._def,unknownKeys:"strip"})}passthrough(){return new Mt({...this._def,unknownKeys:"passthrough"})}extend(e){return new Mt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Mt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:dr.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Mt({...this._def,catchall:e})}pick(e){const t={};return ye.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new Mt({...this._def,shape:()=>t})}omit(e){const t={};return ye.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new Mt({...this._def,shape:()=>t})}deepPartial(){return Pt(this)}partial(e){const t={};return ye.objectKeys(this.shape).forEach((r=>{const a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()})),new Mt({...this._def,shape:()=>t})}required(e){const t={};return ye.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Qt;)e=e._def.innerType;t[r]=e}})),new Mt({...this._def,shape:()=>t})}keyof(){return Wt(ye.objectKeys(this.shape))}}Mt.create=(e,t)=>new Mt({shape:()=>e,unknownKeys:"strip",catchall:Nt.create(),typeName:dr.ZodObject,...Ge(t)}),Mt.strictCreate=(e,t)=>new Mt({shape:()=>e,unknownKeys:"strict",catchall:Nt.create(),typeName:dr.ZodObject,...Ge(t)}),Mt.lazycreate=(e,t)=>new Mt({shape:e,unknownKeys:"strip",catchall:Nt.create(),typeName:dr.ZodObject,...Ge(t)});class $t extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new Re(e.ctx.common.issues)));return Me(t,{code:Ce.invalid_union,unionErrors:r}),Ze}));{let e;const a=[];for(const n of r){const r={...t,common:{...t.common,issues:[]},parent:null},s=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=a.map((e=>new Re(e)));return Me(t,{code:Ce.invalid_union,unionErrors:n}),Ze}}get options(){return this._def.options}}$t.create=(e,t)=>new $t({options:e,typeName:dr.ZodUnion,...Ge(t)});const Zt=e=>e instanceof Jt?Zt(e.schema):e instanceof Xt?Zt(e.innerType()):e instanceof Kt?[e.value]:e instanceof Ht?e.options:e instanceof Yt?ye.objectValues(e.enum):e instanceof tr?Zt(e._def.innerType):e instanceof Et?[void 0]:e instanceof At?[null]:e instanceof Qt?[void 0,...Zt(e.unwrap())]:e instanceof er?[null,...Zt(e.unwrap())]:e instanceof sr||e instanceof ir?Zt(e.unwrap()):e instanceof rr?Zt(e._def.innerType):[];class Dt extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ee.object)return Me(t,{code:Ce.invalid_type,expected:Ee.object,received:t.parsedType}),Ze;const r=this.discriminator,a=t.data[r],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(Me(t,{code:Ce.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Ze)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const a=new Map;for(const r of t){const t=Zt(r.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const n of t){if(a.has(n))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);a.set(n,r)}}return new Dt({typeName:dr.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...Ge(r)})}}function Ft(e,t){const r=Ae(e),a=Ae(t);if(e===t)return{valid:!0,data:e};if(r===Ee.object&&a===Ee.object){const r=ye.objectKeys(t),a=ye.objectKeys(e).filter((e=>-1!==r.indexOf(e))),n={...e,...t};for(const r of a){const a=Ft(e[r],t[r]);if(!a.valid)return{valid:!1};n[r]=a.data}return{valid:!0,data:n}}if(r===Ee.array&&a===Ee.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let a=0;a<e.length;a++){const n=Ft(e[a],t[a]);if(!n.valid)return{valid:!1};r.push(n.data)}return{valid:!0,data:r}}return r===Ee.date&&a===Ee.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class qt extends Xe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(qe(e)||qe(a))return Ze;const n=Ft(e.value,a.value);return n.valid?((Le(e)||Le(a))&&t.dirty(),{status:t.value,value:n.data}):(Me(r,{code:Ce.invalid_intersection_types}),Ze)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>a(e,t))):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}qt.create=(e,t,r)=>new qt({left:e,right:t,typeName:dr.ZodIntersection,...Ge(r)});class Lt extends Xe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ee.array)return Me(r,{code:Ce.invalid_type,expected:Ee.array,received:r.parsedType}),Ze;if(r.data.length<this._def.items.length)return Me(r,{code:Ce.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ze;!this._def.rest&&r.data.length>this._def.items.length&&(Me(r,{code:Ce.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...r.data].map(((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new He(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(a).then((e=>$e.mergeArray(t,e))):$e.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Lt({...this._def,rest:e})}}Lt.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Lt({items:e,typeName:dr.ZodTuple,rest:null,...Ge(t)})};class Ut extends Xe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ee.object)return Me(r,{code:Ce.invalid_type,expected:Ee.object,received:r.parsedType}),Ze;const a=[],n=this._def.keyType,s=this._def.valueType;for(const e in r.data)a.push({key:n._parse(new He(r,e,r.path,e)),value:s._parse(new He(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?$e.mergeObjectAsync(t,a):$e.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new Ut(t instanceof Xe?{keyType:e,valueType:t,typeName:dr.ZodRecord,...Ge(r)}:{keyType:bt.create(),valueType:e,typeName:dr.ZodRecord,...Ge(t)})}}class Bt extends Xe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ee.map)return Me(r,{code:Ce.invalid_type,expected:Ee.map,received:r.parsedType}),Ze;const a=this._def.keyType,n=this._def.valueType,s=[...r.data.entries()].map((([e,t],s)=>({key:a._parse(new He(r,e,r.path,[s,"key"])),value:n._parse(new He(r,t,r.path,[s,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of s){const a=await r.key,n=await r.value;if("aborted"===a.status||"aborted"===n.status)return Ze;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of s){const a=r.key,n=r.value;if("aborted"===a.status||"aborted"===n.status)return Ze;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}}Bt.create=(e,t,r)=>new Bt({valueType:t,keyType:e,typeName:dr.ZodMap,...Ge(r)});class Vt extends Xe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ee.set)return Me(r,{code:Ce.invalid_type,expected:Ee.set,received:r.parsedType}),Ze;const a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(Me(r,{code:Ce.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(Me(r,{code:Ce.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const n=this._def.valueType;function s(e){const r=new Set;for(const a of e){if("aborted"===a.status)return Ze;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}const o=[...r.data.values()].map(((e,t)=>n._parse(new He(r,e,r.path,t))));return r.common.async?Promise.all(o).then((e=>s(e))):s(o)}min(e,t){return new Vt({...this._def,minSize:{value:e,message:Je.toString(t)}})}max(e,t){return new Vt({...this._def,maxSize:{value:e,message:Je.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Vt.create=(e,t)=>new Vt({valueType:e,minSize:null,maxSize:null,typeName:dr.ZodSet,...Ge(t)});class zt extends Xe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ee.function)return Me(t,{code:Ce.invalid_type,expected:Ee.function,received:t.parsedType}),Ze;function r(e,r){return Pe({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,je(),Ne].filter((e=>!!e)),issueData:{code:Ce.invalid_arguments,argumentsError:r}})}function a(e,r){return Pe({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,je(),Ne].filter((e=>!!e)),issueData:{code:Ce.invalid_return_type,returnTypeError:r}})}const n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Gt){const e=this;return Fe((async function(...t){const o=new Re([]),i=await e._def.args.parseAsync(t,n).catch((e=>{throw o.addIssue(r(t,e)),o})),l=await Reflect.apply(s,this,i);return await e._def.returns._def.type.parseAsync(l,n).catch((e=>{throw o.addIssue(a(l,e)),o}))}))}{const e=this;return Fe((function(...t){const o=e._def.args.safeParse(t,n);if(!o.success)throw new Re([r(t,o.error)]);const i=Reflect.apply(s,this,o.data),l=e._def.returns.safeParse(i,n);if(!l.success)throw new Re([a(i,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new zt({...this._def,args:Lt.create(e).rest(Rt.create())})}returns(e){return new zt({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new zt({args:e||Lt.create([]).rest(Rt.create()),returns:t||Rt.create(),typeName:dr.ZodFunction,...Ge(r)})}}class Jt extends Xe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Jt.create=(e,t)=>new Jt({getter:e,typeName:dr.ZodLazy,...Ge(t)});class Kt extends Xe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Me(t,{received:t.data,code:Ce.invalid_literal,expected:this._def.value}),Ze}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Wt(e,t){return new Ht({values:e,typeName:dr.ZodEnum,...Ge(t)})}Kt.create=(e,t)=>new Kt({value:e,typeName:dr.ZodLiteral,...Ge(t)});class Ht extends Xe{constructor(){super(...arguments),Ke.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return Me(t,{expected:ye.joinValues(r),received:t.parsedType,code:Ce.invalid_type}),Ze}if(Ve(this,Ke,"f")||ze(this,Ke,new Set(this._def.values),"f"),!Ve(this,Ke,"f").has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return Me(t,{received:t.data,code:Ce.invalid_enum_value,options:r}),Ze}return Fe(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ht.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ht.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}Ke=new WeakMap,Ht.create=Wt;class Yt extends Xe{constructor(){super(...arguments),We.set(this,void 0)}_parse(e){const t=ye.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Ee.string&&r.parsedType!==Ee.number){const e=ye.objectValues(t);return Me(r,{expected:ye.joinValues(e),received:r.parsedType,code:Ce.invalid_type}),Ze}if(Ve(this,We,"f")||ze(this,We,new Set(ye.getValidEnumValues(this._def.values)),"f"),!Ve(this,We,"f").has(e.data)){const e=ye.objectValues(t);return Me(r,{received:r.data,code:Ce.invalid_enum_value,options:e}),Ze}return Fe(e.data)}get enum(){return this._def.values}}We=new WeakMap,Yt.create=(e,t)=>new Yt({values:e,typeName:dr.ZodNativeEnum,...Ge(t)});class Gt extends Xe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ee.promise&&!1===t.common.async)return Me(t,{code:Ce.invalid_type,expected:Ee.promise,received:t.parsedType}),Ze;const r=t.parsedType===Ee.promise?t.data:Promise.resolve(t.data);return Fe(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Gt.create=(e,t)=>new Gt({type:e,typeName:dr.ZodPromise,...Ge(t)});class Xt extends Xe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===dr.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,n={addIssue:e=>{Me(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===a.type){const e=a.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return Ze;const a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?Ze:"dirty"===a.status||"dirty"===t.value?De(a.value):a}));{if("aborted"===t.value)return Ze;const a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?Ze:"dirty"===a.status||"dirty"===t.value?De(a.value):a}}if("refinement"===a.type){const e=e=>{const t=a.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?Ze:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?Ze:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===a.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Ue(e))return e;const s=a.transform(e.value,n);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>Ue(e)?Promise.resolve(a.transform(e.value,n)).then((e=>({status:t.value,value:e}))):e))}ye.assertNever(a)}}Xt.create=(e,t,r)=>new Xt({schema:e,typeName:dr.ZodEffects,effect:t,...Ge(r)}),Xt.createWithPreprocess=(e,t,r)=>new Xt({schema:t,effect:{type:"preprocess",transform:e},typeName:dr.ZodEffects,...Ge(r)});class Qt extends Xe{_parse(e){return this._getType(e)===Ee.undefined?Fe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Qt.create=(e,t)=>new Qt({innerType:e,typeName:dr.ZodOptional,...Ge(t)});class er extends Xe{_parse(e){return this._getType(e)===Ee.null?Fe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}er.create=(e,t)=>new er({innerType:e,typeName:dr.ZodNullable,...Ge(t)});class tr extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Ee.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}tr.create=(e,t)=>new tr({innerType:e,typeName:dr.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Ge(t)});class rr extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Be(a)?a.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Re(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new Re(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}rr.create=(e,t)=>new rr({innerType:e,typeName:dr.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Ge(t)});class ar extends Xe{_parse(e){if(this._getType(e)!==Ee.nan){const t=this._getOrReturnCtx(e);return Me(t,{code:Ce.invalid_type,expected:Ee.nan,received:t.parsedType}),Ze}return{status:"valid",value:e.data}}}ar.create=e=>new ar({typeName:dr.ZodNaN,...Ge(e)});const nr=Symbol("zod_brand");class sr extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class or extends Xe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Ze:"dirty"===e.status?(t.dirty(),De(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Ze:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new or({in:e,out:t,typeName:dr.ZodPipeline})}}class ir extends Xe{_parse(e){const t=this._def.innerType._parse(e),r=e=>(Ue(e)&&(e.value=Object.freeze(e.value)),e);return Be(t)?t.then((e=>r(e))):r(t)}unwrap(){return this._def.innerType}}function lr(e,t){const r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function ur(e,t={},r){return e?Ct.create().superRefine(((a,n)=>{var s,o;const i=e(a);if(i instanceof Promise)return i.then((e=>{var s,o;if(!e){const e=lr(t,a),i=null===(o=null!==(s=e.fatal)&&void 0!==s?s:r)||void 0===o||o;n.addIssue({code:"custom",...e,fatal:i})}}));if(!i){const e=lr(t,a),i=null===(o=null!==(s=e.fatal)&&void 0!==s?s:r)||void 0===o||o;n.addIssue({code:"custom",...e,fatal:i})}})):Ct.create()}ir.create=(e,t)=>new ir({innerType:e,typeName:dr.ZodReadonly,...Ge(t)});const cr={object:Mt.lazycreate};var dr;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(dr||(dr={}));const pr=bt.create,mr=wt.create,hr=ar.create,fr=kt.create,gr=Tt.create,yr=St.create,vr=It.create,_r=Et.create,br=At.create,xr=Ct.create,wr=Rt.create,kr=Nt.create,Tr=Ot.create,Sr=jt.create,Ir=Mt.create,Er=Mt.strictCreate,Ar=$t.create,Cr=Dt.create,Rr=qt.create,Nr=Lt.create,Or=Ut.create,jr=Bt.create,Pr=Vt.create,Mr=zt.create,$r=Jt.create,Zr=Kt.create,Dr=Ht.create,Fr=Yt.create,qr=Gt.create,Lr=Xt.create,Ur=Qt.create,Br=er.create,Vr=Xt.createWithPreprocess,zr=or.create,Jr={string:e=>bt.create({...e,coerce:!0}),number:e=>wt.create({...e,coerce:!0}),boolean:e=>Tt.create({...e,coerce:!0}),bigint:e=>kt.create({...e,coerce:!0}),date:e=>St.create({...e,coerce:!0})},Kr=Ze;var Wr=Object.freeze({__proto__:null,defaultErrorMap:Ne,setErrorMap:function(e){Oe=e},getErrorMap:je,makeIssue:Pe,EMPTY_PATH:[],addIssueToContext:Me,ParseStatus:$e,INVALID:Ze,DIRTY:De,OK:Fe,isAborted:qe,isDirty:Le,isValid:Ue,isAsync:Be,get util(){return ye},get objectUtil(){return ve},ZodParsedType:Ee,getParsedType:Ae,ZodType:Xe,datetimeRegex:yt,ZodString:bt,ZodNumber:wt,ZodBigInt:kt,ZodBoolean:Tt,ZodDate:St,ZodSymbol:It,ZodUndefined:Et,ZodNull:At,ZodAny:Ct,ZodUnknown:Rt,ZodNever:Nt,ZodVoid:Ot,ZodArray:jt,ZodObject:Mt,ZodUnion:$t,ZodDiscriminatedUnion:Dt,ZodIntersection:qt,ZodTuple:Lt,ZodRecord:Ut,ZodMap:Bt,ZodSet:Vt,ZodFunction:zt,ZodLazy:Jt,ZodLiteral:Kt,ZodEnum:Ht,ZodNativeEnum:Yt,ZodPromise:Gt,ZodEffects:Xt,ZodTransformer:Xt,ZodOptional:Qt,ZodNullable:er,ZodDefault:tr,ZodCatch:rr,ZodNaN:ar,BRAND:nr,ZodBranded:sr,ZodPipeline:or,ZodReadonly:ir,custom:ur,Schema:Xe,ZodSchema:Xe,late:cr,get ZodFirstPartyTypeKind(){return dr},coerce:Jr,any:xr,array:Sr,bigint:fr,boolean:gr,date:yr,discriminatedUnion:Cr,effect:Lr,enum:Dr,function:Mr,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>ur((t=>t instanceof e),t),intersection:Rr,lazy:$r,literal:Zr,map:jr,nan:hr,nativeEnum:Fr,never:kr,null:br,nullable:Br,number:mr,object:Ir,oboolean:()=>gr().optional(),onumber:()=>mr().optional(),optional:Ur,ostring:()=>pr().optional(),pipeline:zr,preprocess:Vr,promise:qr,record:Or,set:Pr,strictObject:Er,string:pr,symbol:vr,transformer:Lr,tuple:Nr,undefined:_r,union:Ar,unknown:wr,void:Tr,NEVER:Kr,ZodIssueCode:Ce,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Re}),Hr=Object.defineProperty,Yr=Object.defineProperties,Gr=Object.getOwnPropertyDescriptors,Xr=Object.getOwnPropertySymbols,Qr=Object.prototype.hasOwnProperty,ea=Object.prototype.propertyIsEnumerable,ta=(e,t,r)=>t in e?Hr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ra=(e,t)=>{for(var r in t||(t={}))Qr.call(t,r)&&ta(e,r,t[r]);if(Xr)for(var r of Xr(t))ea.call(t,r)&&ta(e,r,t[r]);return e},aa=(e,t)=>Yr(e,Gr(t)),na=(e,t)=>{var r={};for(var a in e)Qr.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&Xr)for(var a of Xr(e))t.indexOf(a)<0&&ea.call(e,a)&&(r[a]=e[a]);return r};function sa(e){var t,r,a;const n=[];function s(e){var t;const r=null==e?void 0:e.anthropic;return null!=(t=null==r?void 0:r.cacheControl)?t:null==r?void 0:r.cache_control}for(const{role:o,content:i,providerMetadata:l}of e)switch(o){case"system":n.push({role:"system",content:i,cache_control:s(l)});break;case"user":{if(1===i.length&&"text"===(null==(t=i[0])?void 0:t.type)){n.push({role:"user",content:i[0].text,cache_control:null!=(r=s(l))?r:s(i[0].providerMetadata)});break}const e=s(l),a=i.map((t=>{var r,a,n;switch(t.type){case"text":return{type:"text",text:t.text,cache_control:s(t.providerMetadata)};case"image":return{type:"image_url",image_url:{url:t.image instanceof URL?t.image.toString():`data:${null!=(r=t.mimeType)?r:"image/jpeg"};base64,${Ie(t.image)}`},cache_control:null!=(a=s(t.providerMetadata))?a:e};case"file":return{type:"text",text:t.data instanceof URL?t.data.toString():t.data,cache_control:null!=(n=s(t.providerMetadata))?n:e};default:throw new Error(`Unsupported content part type: ${t}`)}}));n.push({role:"user",content:a});break}case"assistant":{let e="";const t=[];for(const r of i)switch(r.type){case"text":e+=r.text;break;case"tool-call":t.push({id:r.toolCallId,type:"function",function:{name:r.toolName,arguments:JSON.stringify(r.args)}});break;case"reasoning":case"redacted-reasoning":break;default:throw new Error(`Unsupported part: ${r}`)}n.push({role:"assistant",content:e,tool_calls:t.length>0?t:void 0,cache_control:s(l)});break}case"tool":for(const e of i)n.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result),cache_control:null!=(a=s(l))?a:s(e.providerMetadata)});break;default:throw new Error(`Unsupported role: ${o}`)}return n}function oa(e){var t,r;return null!=(r=null==(t=null==e?void 0:e.content)?void 0:t.map((({token:e,logprob:t,top_logprobs:r})=>({token:e,logprob:t,topLogprobs:r?r.map((({token:e,logprob:t})=>({token:e,logprob:t}))):[]}))))?r:void 0}function ia(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var la=Wr.object({error:Wr.object({message:Wr.string(),type:Wr.string(),param:Wr.any().nullable(),code:Wr.string().nullable()})}),ua=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:n,requestBodyValues:s})=>{const o=await a.text(),i=ue(a);if(""===o.trim())return{responseHeaders:i,value:new m({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:i,responseBody:o,isRetryable:null==r?void 0:r(a)})};try{const l=function({text:e,schema:t}){try{const r=re.parse(e);return null==t?r:function({value:e,schema:t}){const r=he({value:e,schema:t});if(!r.success)throw Y.wrap({value:e,cause:r.error});return r.value}({value:r,schema:t})}catch(t){if(F.isInstance(t)||Y.isInstance(t))throw t;throw new F({text:e,cause:t})}}({text:o,schema:e});return{responseHeaders:i,value:new m({message:t(l),url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:i,responseBody:o,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:i,value:new m({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:i,responseBody:o,isRetryable:null==r?void 0:r(a)})}}})({errorSchema:la,errorToMessage:e=>e.error.message}),ca=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,prompt:t,maxTokens:r,temperature:a,topP:n,frequencyPenalty:s,presencePenalty:o,seed:i,stopSequences:l,responseFormat:u,topK:c,providerMetadata:d}){var p;const m=e.type,h=null!=(p=null==d?void 0:d.openrouter)?p:{},f=ra(ra(ra({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:a,top_p:n,frequency_penalty:s,presence_penalty:o,seed:i,stop:l,response_format:u,top_k:c,messages:sa(t),include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody),h);switch(m){case"regular":return ra(ra({},f),function(e){var t;const r=(null==(t=e.tools)?void 0:t.length)?e.tools:void 0;if(null==r)return{tools:void 0,tool_choice:void 0};const a=r.map((e=>function(e){return"parameters"in e}(e)?{type:"function",function:{name:e.name,description:e.description,parameters:e.parameters}}:{type:"function",function:{name:e.name}})),n=e.toolChoice;if(null==n)return{tools:a,tool_choice:void 0};const s=n.type;switch(s){case"auto":case"none":case"required":return{tools:a,tool_choice:s};case"tool":return{tools:a,tool_choice:{type:"function",function:{name:n.toolName}}};default:throw new Error(`Unsupported tool choice type: ${s}`)}}(e));case"object-json":return aa(ra({},f),{response_format:{type:"json_object"}});case"object-tool":return aa(ra({},f),{tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}}]});default:throw new ee({functionality:`${m} mode`})}}async doGenerate(e){var t,r,a,n,s,o,i;const l=this.getArgs(e),{responseHeaders:u,value:c}=await be({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:le(this.config.headers(),e.headers),body:l,failedResponseHandler:ua,successfulResponseHandler:ke(pa),abortSignal:e.abortSignal,fetch:this.config.fetch}),d=l,{messages:p}=d,m=na(d,["messages"]),h=c.choices[0];if(!h)throw new Error("No choice in response");return{response:{id:c.id,modelId:c.model},text:null!=(t=h.message.content)?t:void 0,reasoning:null!=(r=h.message.reasoning)?r:void 0,toolCalls:null==(a=h.message.tool_calls)?void 0:a.map((e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:ce(),toolName:e.function.name,args:e.function.arguments}})),finishReason:ia(h.finish_reason),usage:{promptTokens:null!=(s=null==(n=c.usage)?void 0:n.prompt_tokens)?s:0,completionTokens:null!=(i=null==(o=c.usage)?void 0:o.completion_tokens)?i:0},rawCall:{rawPrompt:p,rawSettings:m},rawResponse:{headers:u},warnings:[],logprobs:oa(h.logprobs)}}async doStream(e){const t=this.getArgs(e),{responseHeaders:r,value:a}=await be({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:le(this.config.headers(),e.headers),body:aa(ra({},t),{stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0}),failedResponseHandler:ua,successfulResponseHandler:we(ma),abortSignal:e.abortSignal,fetch:this.config.fetch}),n=t,{messages:s}=n,o=na(n,["messages"]),i=[];let l,u="other",c={promptTokens:Number.NaN,completionTokens:Number.NaN};return{stream:a.pipeThrough(new TransformStream({transform(e,t){var r,a,n,s,o,d,p,m,h,f,g,y;if(!e.success)return u="error",void t.enqueue({type:"error",error:e.error});const v=e.value;if("error"in v)return u="error",void t.enqueue({type:"error",error:v.error});v.id&&t.enqueue({type:"response-metadata",id:v.id}),v.model&&t.enqueue({type:"response-metadata",modelId:v.model}),null!=v.usage&&(c={promptTokens:v.usage.prompt_tokens,completionTokens:v.usage.completion_tokens});const _=v.choices[0];if(null!=(null==_?void 0:_.finish_reason)&&(u=ia(_.finish_reason)),null==(null==_?void 0:_.delta))return;const b=_.delta;null!=b.content&&t.enqueue({type:"text-delta",textDelta:b.content}),null!=b.reasoning&&t.enqueue({type:"reasoning",textDelta:b.reasoning});const x=oa(null==_?void 0:_.logprobs);if((null==x?void 0:x.length)&&(void 0===l&&(l=[]),l.push(...x)),null!=b.tool_calls)for(const e of b.tool_calls){const l=e.index;if(null==i[l]){if("function"!==e.type)throw new P({data:e,message:"Expected 'function' type."});if(null==e.id)throw new P({data:e,message:"Expected 'id' to be a string."});if(null==(null==(r=e.function)?void 0:r.name))throw new P({data:e,message:"Expected 'function.name' to be a string."});i[l]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(a=e.function.arguments)?a:""}};const u=i[l];if(null==u)throw new Error("Tool call is missing");null!=(null==(n=u.function)?void 0:n.name)&&null!=(null==(s=u.function)?void 0:s.arguments)&&ge(u.function.arguments)&&(t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:u.id,toolName:u.function.name,argsTextDelta:u.function.arguments}),t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(o=u.id)?o:ce(),toolName:u.function.name,args:u.function.arguments}));continue}const u=i[l];if(null==u)throw new Error("Tool call is missing");null!=(null==(d=e.function)?void 0:d.arguments)&&(u.function.arguments+=null!=(m=null==(p=e.function)?void 0:p.arguments)?m:""),t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:u.id,toolName:u.function.name,argsTextDelta:null!=(h=e.function.arguments)?h:""}),null!=(null==(f=u.function)?void 0:f.name)&&null!=(null==(g=u.function)?void 0:g.arguments)&&ge(u.function.arguments)&&t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(y=u.id)?y:ce(),toolName:u.function.name,args:u.function.arguments})}},flush(e){e.enqueue({type:"finish",finishReason:u,logprobs:l,usage:c})}})),rawCall:{rawPrompt:s,rawSettings:o},rawResponse:{headers:r},warnings:[]}}},da=Wr.object({id:Wr.string().optional(),model:Wr.string().optional(),usage:Wr.object({prompt_tokens:Wr.number(),completion_tokens:Wr.number(),total_tokens:Wr.number()}).nullish()}),pa=da.extend({choices:Wr.array(Wr.object({message:Wr.object({role:Wr.literal("assistant"),content:Wr.string().nullable().optional(),reasoning:Wr.string().nullable().optional(),tool_calls:Wr.array(Wr.object({id:Wr.string().optional().nullable(),type:Wr.literal("function"),function:Wr.object({name:Wr.string(),arguments:Wr.string()})})).optional()}),index:Wr.number(),logprobs:Wr.object({content:Wr.array(Wr.object({token:Wr.string(),logprob:Wr.number(),top_logprobs:Wr.array(Wr.object({token:Wr.string(),logprob:Wr.number()}))})).nullable()}).nullable().optional(),finish_reason:Wr.string().optional().nullable()}))}),ma=Wr.union([da.extend({choices:Wr.array(Wr.object({delta:Wr.object({role:Wr.enum(["assistant"]).optional(),content:Wr.string().nullish(),reasoning:Wr.string().nullish().optional(),tool_calls:Wr.array(Wr.object({index:Wr.number(),id:Wr.string().nullish(),type:Wr.literal("function").optional(),function:Wr.object({name:Wr.string().nullish(),arguments:Wr.string().nullish()})})).nullish()}).nullish(),logprobs:Wr.object({content:Wr.array(Wr.object({token:Wr.string(),logprob:Wr.number(),top_logprobs:Wr.array(Wr.object({token:Wr.string(),logprob:Wr.number()}))})).nullable()}).nullish(),finish_reason:Wr.string().nullable().optional(),index:Wr.number()}))}),la]);function ha(e){return null==e?void 0:e.tokens.map(((t,r)=>{var a,n;return{token:t,logprob:null!=(a=e.token_logprobs[r])?a:0,topLogprobs:e.top_logprobs?Object.entries(null!=(n=e.top_logprobs[r])?n:{}).map((([e,t])=>({token:e,logprob:t}))):[]}}))}var fa=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:a,temperature:n,topP:s,frequencyPenalty:o,presencePenalty:i,seed:l,responseFormat:u,topK:c,stopSequences:d,providerMetadata:p}){var m,h;const f=e.type,g=null!=(m=null==p?void 0:p.openrouter)?m:{},{prompt:y}=function({prompt:e,inputFormat:t,user:r="user",assistant:a="assistant"}){if("prompt"===t&&1===e.length&&e[0]&&"user"===e[0].role&&1===e[0].content.length&&e[0].content[0]&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let n="";e[0]&&"system"===e[0].role&&(n+=`${e[0].content}\n\n`,e=e.slice(1));for(const{role:t,content:s}of e)switch(t){case"system":throw new C({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":n+=`${r}:\n${s.map((e=>{switch(e.type){case"text":return e.text;case"image":throw new ee({functionality:"images"});case"file":throw new ee({functionality:"file attachments"});default:throw new Error(`Unsupported content type: ${e}`)}})).join("")}\n\n`;break;case"assistant":n+=`${a}:\n${s.map((e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new ee({functionality:"tool-call messages"});case"reasoning":throw new ee({functionality:"reasoning messages"});case"redacted-reasoning":throw new ee({functionality:"redacted reasoning messages"});default:throw new Error(`Unsupported content type: ${e}`)}})).join("")}\n\n`;break;case"tool":throw new ee({functionality:"tool messages"});default:throw new Error(`Unsupported role: ${t}`)}return n+=`${a}:\n`,{prompt:n}}({prompt:r,inputFormat:t}),v=ra(ra(ra({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:a,temperature:n,top_p:s,frequency_penalty:o,presence_penalty:i,seed:l,stop:d,response_format:u,top_k:c,prompt:y,include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody),g);switch(f){case"regular":if(null==(h=e.tools)?void 0:h.length)throw new ee({functionality:"tools"});if(e.toolChoice)throw new ee({functionality:"toolChoice"});return v;case"object-json":throw new ee({functionality:"object-json mode"});case"object-tool":throw new ee({functionality:"object-tool mode"});default:throw new ee({functionality:`${f} mode`})}}async doGenerate(e){var t,r,a,n,s;const o=this.getArgs(e),{responseHeaders:i,value:l}=await be({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:le(this.config.headers(),e.headers),body:o,failedResponseHandler:ua,successfulResponseHandler:ke(ga),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=o,{prompt:c}=u,d=na(u,["prompt"]);if("error"in l)throw new Error(`${l.error.message}`);const p=l.choices[0];if(!p)throw new Error("No choice in OpenRouter completion response");return{response:{id:l.id,modelId:l.model},text:null!=(t=p.text)?t:"",reasoning:p.reasoning||void 0,usage:{promptTokens:null!=(a=null==(r=l.usage)?void 0:r.prompt_tokens)?a:0,completionTokens:null!=(s=null==(n=l.usage)?void 0:n.completion_tokens)?s:0},finishReason:ia(p.finish_reason),logprobs:ha(p.logprobs),rawCall:{rawPrompt:c,rawSettings:d},rawResponse:{headers:i},warnings:[]}}async doStream(e){const t=this.getArgs(e),{responseHeaders:r,value:a}=await be({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:le(this.config.headers(),e.headers),body:aa(ra({},this.getArgs(e)),{stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0}),failedResponseHandler:ua,successfulResponseHandler:we(ga),abortSignal:e.abortSignal,fetch:this.config.fetch}),n=t,{prompt:s}=n,o=na(n,["prompt"]);let i,l="other",u={promptTokens:Number.NaN,completionTokens:Number.NaN};return{stream:a.pipeThrough(new TransformStream({transform(e,t){if(!e.success)return l="error",void t.enqueue({type:"error",error:e.error});const r=e.value;if("error"in r)return l="error",void t.enqueue({type:"error",error:r.error});null!=r.usage&&(u={promptTokens:r.usage.prompt_tokens,completionTokens:r.usage.completion_tokens});const a=r.choices[0];null!=(null==a?void 0:a.finish_reason)&&(l=ia(a.finish_reason)),null!=(null==a?void 0:a.text)&&t.enqueue({type:"text-delta",textDelta:a.text});const n=ha(null==a?void 0:a.logprobs);(null==n?void 0:n.length)&&(void 0===i&&(i=[]),i.push(...n))},flush(e){e.enqueue({type:"finish",finishReason:l,logprobs:i,usage:u})}})),rawCall:{rawPrompt:s,rawSettings:o},rawResponse:{headers:r},warnings:[]}}},ga=Wr.union([Wr.object({id:Wr.string().optional(),model:Wr.string().optional(),choices:Wr.array(Wr.object({text:Wr.string(),reasoning:Wr.string().nullish().optional(),finish_reason:Wr.string().nullish(),index:Wr.number(),logprobs:Wr.object({tokens:Wr.array(Wr.string()),token_logprobs:Wr.array(Wr.number()),top_logprobs:Wr.array(Wr.record(Wr.string(),Wr.number())).nullable()}).nullable().optional()})),usage:Wr.object({prompt_tokens:Wr.number(),completion_tokens:Wr.number()}).optional().nullable()}),la]);function ya(e={}){var t,r,a;const n=null!=(r=null==(s=null!=(t=e.baseURL)?t:e.baseUrl)?void 0:s.replace(/\/$/,""))?r:"https://openrouter.ai/api/v1";var s;const o=null!=(a=e.compatibility)?a:"compatible",i=()=>ra({Authorization:`Bearer ${pe({apiKey:e.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},e.headers),l=(t,r={})=>new ca(t,r,{provider:"openrouter.chat",url:({path:e})=>`${n}${e}`,headers:i,compatibility:o,fetch:e.fetch,extraBody:e.extraBody}),u=(t,r={})=>new fa(t,r,{provider:"openrouter.completion",url:({path:e})=>`${n}${e}`,headers:i,compatibility:o,fetch:e.fetch,extraBody:e.extraBody}),c=(e,t)=>{if(new.target)throw new Error("The OpenRouter model function cannot be called with the new keyword.");return"openai/gpt-3.5-turbo-instruct"===e?u(e,t):l(e,t)},d=function(e,t){return c(e,t)};return d.languageModel=c,d.chat=l,d.completion=u,d}ya({compatibility:"strict"});var va,_a="vercel.ai.error",ba=Symbol.for(_a),xa=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[va]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,_a)}static hasMarker(e,t){const r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};va=ba;var wa,ka=xa,Ta="AI_APICallError",Sa=`vercel.ai.error.${Ta}`,Ia=Symbol.for(Sa),Ea=class extends ka{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:n,responseBody:s,cause:o,isRetryable:i=null!=a&&(408===a||409===a||429===a||a>=500),data:l}){super({name:Ta,message:e,cause:o}),this[wa]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=n,this.responseBody=s,this.isRetryable=i,this.data=l}static isInstance(e){return ka.hasMarker(e,Sa)}};wa=Ia;Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError");function Aa(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}var Ca,Ra="AI_InvalidArgumentError",Na=`vercel.ai.error.${Ra}`,Oa=Symbol.for(Na),ja=class extends ka{constructor({message:e,cause:t,argument:r}){super({name:Ra,message:e,cause:t}),this[Ca]=!0,this.argument=r}static isInstance(e){return ka.hasMarker(e,Na)}};Ca=Oa;var Pa,Ma="AI_InvalidPromptError",$a=`vercel.ai.error.${Ma}`,Za=Symbol.for($a),Da=class extends ka{constructor({prompt:e,message:t,cause:r}){super({name:Ma,message:`Invalid prompt: ${t}`,cause:r}),this[Pa]=!0,this.prompt=e}static isInstance(e){return ka.hasMarker(e,$a)}};Pa=Za;Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var Fa,qa="AI_JSONParseError",La=`vercel.ai.error.${qa}`,Ua=Symbol.for(La),Ba=class extends ka{constructor({text:e,cause:t}){super({name:qa,message:`JSON parsing failed: Text: ${e}.\nError message: ${Aa(t)}`,cause:t}),this[Fa]=!0,this.text=e}static isInstance(e){return ka.hasMarker(e,La)}};Fa=Ua;Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var Va,za="AI_TypeValidationError",Ja=`vercel.ai.error.${za}`,Ka=Symbol.for(Ja);Va=Ka;var Wa=class e extends ka{constructor({value:e,cause:t}){super({name:za,message:`Type validation failed: Value: ${JSON.stringify(e)}.\nError message: ${Aa(t)}`,cause:t}),this[Va]=!0,this.value=e}static isInstance(e){return ka.hasMarker(e,Ja)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}},Ha=(Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError"),({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const n=te(r,t);if(null==e)return n;if(r.includes(a))throw new ja({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${n(t)}`});Ha();var Ya=Symbol.for("vercel.ai.validator");function Ga({value:e,schema:t}){const r=function(e){return function(e){return"object"==typeof e&&null!==e&&Ya in e&&!0===e[Ya]&&"validate"in e}(e)?e:function(e){return t=t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}},{[Ya]:!0,validate:t};var t}(e)}(t);try{if(null==r.validate)return{success:!0,value:e};const t=r.validate(e);return t.success?t:{success:!1,error:Wa.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:Wa.wrap({value:e,cause:t})}}}function Xa({text:e,schema:t}){try{const r=re.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};const a=Ga({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(t){return{success:!1,error:Ba.isInstance(t)?t:new Ba({text:e,cause:t})}}}var{btoa:Qa,atob:en}=globalThis;function tn(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=en(t);return Uint8Array.from(r,(e=>e.codePointAt(0)))}function rn(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return Qa(t)}var an="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof r.g?r.g:{},nn="1.9.0",sn=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/,on=function(e){var t=new Set([e]),r=new Set,a=e.match(sn);if(!a)return function(){return!1};var n=+a[1],s=+a[2],o=+a[3];if(null!=a[4])return function(t){return t===e};function i(e){return r.add(e),!1}function l(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;var a=e.match(sn);if(!a)return i(e);var u=+a[1],c=+a[2],d=+a[3];return null!=a[4]||n!==u?i(e):0===n?s===c&&o<=d?l(e):i(e):s<=c?l(e):i(e)}}(nn),ln=nn.split(".")[0],un=Symbol.for("opentelemetry.js.api."+ln),cn=an;function dn(e,t,r,a){var n;void 0===a&&(a=!1);var s=cn[un]=null!==(n=cn[un])&&void 0!==n?n:{version:nn};if(!a&&s[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(o.stack||o.message),!1}return s.version!==nn?(o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+e+" does not match previously registered API v"+nn),r.error(o.stack||o.message),!1):(s[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+nn+"."),!0)}function pn(e){var t,r,a=null===(t=cn[un])||void 0===t?void 0:t.version;if(a&&on(a))return null===(r=cn[un])||void 0===r?void 0:r[e]}function mn(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+nn+".");var r=cn[un];r&&delete r[e]}var hn,fn=new function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(e){return r._currentContext.get(e)},r.setValue=function(t,a){var n=new e(r._currentContext);return n._currentContext.set(t,a),n},r.deleteValue=function(t){var a=new e(r._currentContext);return a._currentContext.delete(t),a}},gn=function(){function e(){}return e.prototype.active=function(){return fn},e.prototype.with=function(e,t,r){for(var a=[],n=3;n<arguments.length;n++)a[n-3]=arguments[n];return t.call.apply(t,function(e,t,r){if(r||2===arguments.length)for(var a,n=0,s=t.length;n<s;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}([r],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)o.push(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}(a),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),yn=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vn("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vn("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vn("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vn("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vn("verbose",this._namespace,e)},e}();function vn(e,t,r){var a=pn("diag");if(a)return r.unshift(t),a[e].apply(a,function(e,t,r){if(r||2===arguments.length)for(var a,n=0,s=t.length;n<s;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}([],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)o.push(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}(r),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(hn||(hn={}));var _n,bn=function(){function e(){function e(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var a=pn("diag");if(a)return a[e].apply(a,function(e,t,r){if(r||2===arguments.length)for(var a,n=0,s=t.length;n<s;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}([],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)o.push(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}(t),!1))}}var t=this;t.setLogger=function(e,r){var a,n,s;if(void 0===r&&(r={logLevel:hn.INFO}),e===t){var o=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(a=o.stack)&&void 0!==a?a:o.message),!1}"number"==typeof r&&(r={logLevel:r});var i=pn("diag"),l=function(e,t){function r(r,a){var n=t[r];return"function"==typeof n&&e>=a?n.bind(t):function(){}}return e<hn.NONE?e=hn.NONE:e>hn.ALL&&(e=hn.ALL),t=t||{},{error:r("error",hn.ERROR),warn:r("warn",hn.WARN),info:r("info",hn.INFO),debug:r("debug",hn.DEBUG),verbose:r("verbose",hn.VERBOSE)}}(null!==(n=r.logLevel)&&void 0!==n?n:hn.INFO,e);if(i&&!r.suppressOverrideMessage){var u=null!==(s=(new Error).stack)&&void 0!==s?s:"<failed to generate stacktrace>";i.warn("Current logger will be overwritten from "+u),l.warn("Current logger will overwrite one already registered from "+u)}return dn("diag",l,t,!0)},t.disable=function(){mn("diag",t)},t.createComponentLogger=function(e){return new yn(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),xn="context",wn=new gn,kn=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return dn(xn,e,bn.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,r){for(var a,n=[],s=3;s<arguments.length;s++)n[s-3]=arguments[s];return(a=this._getContextManager()).with.apply(a,function(e,t,r){if(r||2===arguments.length)for(var a,n=0,s=t.length;n<s;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}([e,t,r],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,s=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=s.next()).done;)o.push(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}(n),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return pn(xn)||wn},e.prototype.disable=function(){this._getContextManager().disable(),mn(xn,bn.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(_n||(_n={}));var Tn="0000000000000000",Sn="00000000000000000000000000000000",In={traceId:Sn,spanId:Tn,traceFlags:_n.NONE},En=function(){function e(e){void 0===e&&(e=In),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.addLink=function(e){return this},e.prototype.addLinks=function(e){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),An=Symbol.for("OpenTelemetry Context Key SPAN");function Cn(e){return e.getValue(An)||void 0}function Rn(){return Cn(kn.getInstance().active())}function Nn(e,t){return e.setValue(An,t)}function On(e){return e.deleteValue(An)}function jn(e,t){return Nn(e,new En(t))}function Pn(e){var t;return null===(t=Cn(e))||void 0===t?void 0:t.spanContext()}var Mn=/^([0-9a-f]{32})$/i,$n=/^[0-9a-f]{16}$/i;function Zn(e){return r=e.traceId,Mn.test(r)&&r!==Sn&&(t=e.spanId,$n.test(t)&&t!==Tn);var t,r}function Dn(e){return new En(e)}var Fn,qn=kn.getInstance(),Ln=function(){function e(){}return e.prototype.startSpan=function(e,t,r){if(void 0===r&&(r=qn.active()),Boolean(null==t?void 0:t.root))return new En;var a,n=r&&Pn(r);return"object"==typeof(a=n)&&"string"==typeof a.spanId&&"string"==typeof a.traceId&&"number"==typeof a.traceFlags&&Zn(n)?new En(n):new En},e.prototype.startActiveSpan=function(e,t,r,a){var n,s,o;if(!(arguments.length<2)){2===arguments.length?o=t:3===arguments.length?(n=t,o=r):(n=t,s=r,o=a);var i=null!=s?s:qn.active(),l=this.startSpan(e,n,i),u=Nn(i,l);return qn.with(u,o,void 0,l)}},e}(),Un=new Ln,Bn=function(){function e(e,t,r,a){this._provider=e,this.name=t,this.version=r,this.options=a}return e.prototype.startSpan=function(e,t,r){return this._getTracer().startSpan(e,t,r)},e.prototype.startActiveSpan=function(e,t,r,a){var n=this._getTracer();return Reflect.apply(n.startActiveSpan,n,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Un},e}(),Vn=new(function(){function e(){}return e.prototype.getTracer=function(e,t,r){return new Ln},e}()),zn=function(){function e(){}return e.prototype.getTracer=function(e,t,r){var a;return null!==(a=this.getDelegateTracer(e,t,r))&&void 0!==a?a:new Bn(this,e,t,r)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:Vn},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,r){var a;return null===(a=this._delegate)||void 0===a?void 0:a.getTracer(e,t,r)},e}(),Jn="trace",Kn=function(){function e(){this._proxyTracerProvider=new zn,this.wrapSpanContext=Dn,this.isSpanContextValid=Zn,this.deleteSpan=On,this.getSpan=Cn,this.getActiveSpan=Rn,this.getSpanContext=Pn,this.setSpan=Nn,this.setSpanContext=jn}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=dn(Jn,this._proxyTracerProvider,bn.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return pn(Jn)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){mn(Jn,bn.instance()),this._proxyTracerProvider=new zn},e}().getInstance();!function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(Fn||(Fn={}));var Wn,Hn="vercel.ai.error",Yn=Symbol.for(Hn),Gn=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[Wn]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,Hn)}static hasMarker(e,t){const r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};Wn=Yn;var Xn=Gn;Symbol.for("vercel.ai.error.AI_APICallError"),Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError");function Qn(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}var es,ts="AI_InvalidArgumentError",rs=`vercel.ai.error.${ts}`,as=Symbol.for(rs),ns=class extends Xn{constructor({message:e,cause:t,argument:r}){super({name:ts,message:e,cause:t}),this[es]=!0,this.argument=r}static isInstance(e){return Xn.hasMarker(e,rs)}};es=as;Symbol.for("vercel.ai.error.AI_InvalidPromptError"),Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var ss,os="AI_JSONParseError",is=`vercel.ai.error.${os}`,ls=Symbol.for(is),us=class extends Xn{constructor({text:e,cause:t}){super({name:os,message:`JSON parsing failed: Text: ${e}.\nError message: ${Qn(t)}`,cause:t}),this[ss]=!0,this.text=e}static isInstance(e){return Xn.hasMarker(e,is)}};ss=ls;Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var cs,ds="AI_TypeValidationError",ps=`vercel.ai.error.${ds}`,ms=Symbol.for(ps);cs=ms;var hs=class e extends Xn{constructor({value:e,cause:t}){super({name:ds,message:`Type validation failed: Value: ${JSON.stringify(e)}.\nError message: ${Qn(t)}`,cause:t}),this[cs]=!0,this.value=e}static isInstance(e){return Xn.hasMarker(e,ps)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}},fs=(Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError"),(({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{const n=te(r,t);if(null==e)return n;if(r.includes(a))throw new ns({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${n(t)}`})()),gs=Symbol.for("vercel.ai.validator");function ys({value:e,schema:t}){const r=function(e){return function(e){return"object"==typeof e&&null!==e&&gs in e&&!0===e[gs]&&"validate"in e}(e)?e:function(e){return t=t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}},{[gs]:!0,validate:t};var t}(e)}(t);try{if(null==r.validate)return{success:!0,value:e};const t=r.validate(e);return t.success?t:{success:!1,error:hs.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:hs.wrap({value:e,cause:t})}}}function vs({text:e,schema:t}){try{const r=re.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};const a=ys({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(t){return{success:!1,error:us.isInstance(t)?t:new us({text:e,cause:t})}}}var{btoa:_s,atob:bs}=globalThis;const xs=Symbol("Let zodToJsonSchema decide on which parser to use"),ws={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function ks(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function Ts(e,t,r,a,n){e[t]=r,ks(e,t,a,n)}function Ss(e,t){return Ys(e.type._def,t)}function Is(e,t,r){const a=r??t.dateStrategy;if(Array.isArray(a))return{anyOf:a.map(((r,a)=>Is(e,t,r)))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Es(e,t)}}const Es=(e,t)=>{const r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(const a of e.checks)switch(a.kind){case"min":Ts(r,"minimum",a.value,a.message,t);break;case"max":Ts(r,"maximum",a.value,a.message,t)}return r};let As;const Cs=/^[cC][^\s-]{8,}$/,Rs=/^[0-9a-z]+$/,Ns=/^[0-9A-HJKMNP-TV-Z]{26}$/,Os=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,js=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ps=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ms=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$s=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Zs=/^[a-zA-Z0-9_-]{21}$/,Ds=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function Fs(e,t){const r={type:"string"};if(e.checks)for(const a of e.checks)switch(a.kind){case"min":Ts(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":Ts(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":Us(r,"email",a.message,t);break;case"format:idn-email":Us(r,"idn-email",a.message,t);break;case"pattern:zod":Bs(r,Os,a.message,t)}break;case"url":Us(r,"uri",a.message,t);break;case"uuid":Us(r,"uuid",a.message,t);break;case"regex":Bs(r,a.regex,a.message,t);break;case"cuid":Bs(r,Cs,a.message,t);break;case"cuid2":Bs(r,Rs,a.message,t);break;case"startsWith":Bs(r,RegExp(`^${qs(a.value,t)}`),a.message,t);break;case"endsWith":Bs(r,RegExp(`${qs(a.value,t)}$`),a.message,t);break;case"datetime":Us(r,"date-time",a.message,t);break;case"date":Us(r,"date",a.message,t);break;case"time":Us(r,"time",a.message,t);break;case"duration":Us(r,"duration",a.message,t);break;case"length":Ts(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),Ts(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":Bs(r,RegExp(qs(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&Us(r,"ipv4",a.message,t),"v4"!==a.version&&Us(r,"ipv6",a.message,t);break;case"base64url":Bs(r,$s,a.message,t);break;case"jwt":Bs(r,Ds,a.message,t);break;case"cidr":"v6"!==a.version&&Bs(r,js,a.message,t),"v4"!==a.version&&Bs(r,Ps,a.message,t);break;case"emoji":Bs(r,(void 0===As&&(As=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),As),a.message,t);break;case"ulid":Bs(r,Ns,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":Us(r,"binary",a.message,t);break;case"contentEncoding:base64":Ts(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":Bs(r,Ms,a.message,t)}break;case"nanoid":Bs(r,Zs,a.message,t)}return r}function qs(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)Ls.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}const Ls=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Us(e,t,r,a){e.format||e.anyOf?.some((e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):Ts(e,"format",t,r,a)}function Bs(e,t,r,a){e.pattern||e.allOf?.some((e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:Vs(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):Ts(e,"pattern",Vs(t,a),r,a)}function Vs(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const r=e.flags.includes("i"),a=e.flags.includes("m"),n=e.flags.includes("s"),s=r?e.source.toLowerCase():e.source;let o="",i=!1,l=!1,u=!1;for(let e=0;e<s.length;e++)if(i)o+=s[e],i=!1;else{if(r)if(l){if(s[e].match(/[a-z]/)){u?(o+=s[e],o+=`${s[e-2]}-${s[e]}`.toUpperCase(),u=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(o+=s[e],u=!0):o+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){o+=`[${s[e]}${s[e].toUpperCase()}]`;continue}if(a){if("^"===s[e]){o+="(^|(?<=[\r\n]))";continue}if("$"===s[e]){o+="($|(?=[\r\n]))";continue}}n&&"."===s[e]?o+=l?`${s[e]}\r\n`:`[${s[e]}\r\n]`:(o+=s[e],"\\"===s[e]?i=!0:l&&"]"===s[e]?l=!1:l||"["!==s[e]||(l=!0))}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}function zs(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===dr.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce(((r,a)=>({...r,[a]:Ys(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}})),{}),additionalProperties:t.rejectedAdditionalProperties};const r={type:"object",additionalProperties:Ys(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===dr.ZodString&&e.keyType._def.checks?.length){const{type:a,...n}=Fs(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===dr.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===dr.ZodBranded&&e.keyType._def.type._def.typeName===dr.ZodString&&e.keyType._def.type._def.checks?.length){const{type:a,...n}=Ss(e.keyType._def,t);return{...r,propertyNames:n}}return r}const Js={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},Ks=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map(((e,r)=>Ys(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]}))).filter((e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0)));return r.length?{anyOf:r}:void 0};function Ws(e){try{return e.isOptional()}catch{return!0}}const Hs=(e,t,r)=>{switch(t){case dr.ZodString:return Fs(e,r);case dr.ZodNumber:return function(e,t){const r={type:"number"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"int":r.type="integer",ks(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?Ts(r,"minimum",a.value,a.message,t):Ts(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),Ts(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?Ts(r,"maximum",a.value,a.message,t):Ts(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),Ts(r,"maximum",a.value,a.message,t));break;case"multipleOf":Ts(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case dr.ZodObject:return function(e,t){const r="openAi"===t.target,a={type:"object",properties:{}},n=[],s=e.shape();for(const e in s){let o=s[e];if(void 0===o||void 0===o._def)continue;let i=Ws(o);i&&r&&(o instanceof Qt&&(o=o._def.innerType),o.isNullable()||(o=o.nullable()),i=!1);const l=Ys(o._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(a.properties[e]=l,i||n.push(e))}n.length&&(a.required=n);const o=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return Ys(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==o&&(a.additionalProperties=o),a}(e,r);case dr.ZodBigInt:return function(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?Ts(r,"minimum",a.value,a.message,t):Ts(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),Ts(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?Ts(r,"maximum",a.value,a.message,t):Ts(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),Ts(r,"maximum",a.value,a.message,t));break;case"multipleOf":Ts(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case dr.ZodBoolean:return{type:"boolean"};case dr.ZodDate:return Is(e,r);case dr.ZodUndefined:return{not:{}};case dr.ZodNull:return function(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}(r);case dr.ZodArray:return function(e,t){const r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==dr.ZodAny&&(r.items=Ys(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ts(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ts(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ts(r,"minItems",e.exactLength.value,e.exactLength.message,t),Ts(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case dr.ZodUnion:case dr.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return Ks(e,t);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every((e=>e._def.typeName in Js&&(!e._def.checks||!e._def.checks.length)))){const e=r.reduce(((e,t)=>{const r=Js[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e}),[]);return{type:e.length>1?e:e[0]}}if(r.every((e=>"ZodLiteral"===e._def.typeName&&!e.description))){const e=r.reduce(((e,t)=>{const r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}}),[]);if(e.length===r.length){const t=e.filter(((e,t,r)=>r.indexOf(e)===t));return{type:t.length>1?t:t[0],enum:r.reduce(((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value]),[])}}}else if(r.every((e=>"ZodEnum"===e._def.typeName)))return{type:"string",enum:r.reduce(((e,t)=>[...e,...t._def.values.filter((t=>!e.includes(t)))]),[])};return Ks(e,t)}(e,r);case dr.ZodIntersection:return function(e,t){const r=[Ys(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Ys(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter((e=>!!e));let a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0;const n=[];return r.forEach((e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:r,...a}=e;t=a}else a=void 0;n.push(t)}else n.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);var t})),n.length?{allOf:n,...a}:void 0}(e,r);case dr.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map(((e,r)=>Ys(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[]),additionalItems:Ys(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map(((e,r)=>Ys(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]}))).reduce(((e,t)=>void 0===t?e:[...e,t]),[])}}(e,r);case dr.ZodRecord:return zs(e,r);case dr.ZodLiteral:return function(e,t){const r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case dr.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case dr.ZodNativeEnum:return function(e){const t=e.values,r=Object.keys(e.values).filter((e=>"number"!=typeof t[t[e]])).map((e=>t[e])),a=Array.from(new Set(r.map((e=>typeof e))));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case dr.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:Js[e.innerType._def.typeName],nullable:!0}:{type:[Js[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){const r=Ys(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const r=Ys(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case dr.ZodOptional:return((e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return Ys(e.innerType._def,t);const r=Ys(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}})(e,r);case dr.ZodMap:return function(e,t){return"record"===t.mapStrategy?zs(e,t):{type:"array",maxItems:125,items:{type:"array",items:[Ys(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},Ys(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case dr.ZodSet:return function(e,t){const r={type:"array",uniqueItems:!0,items:Ys(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ts(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ts(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case dr.ZodLazy:return()=>e.getter()._def;case dr.ZodPromise:return function(e,t){return Ys(e.type._def,t)}(e,r);case dr.ZodNaN:case dr.ZodNever:return{not:{}};case dr.ZodEffects:return function(e,t){return"input"===t.effectStrategy?Ys(e.schema._def,t):{}}(e,r);case dr.ZodAny:case dr.ZodUnknown:return{};case dr.ZodDefault:return function(e,t){return{...Ys(e.innerType._def,t),default:e.defaultValue()}}(e,r);case dr.ZodBranded:return Ss(e,r);case dr.ZodReadonly:case dr.ZodCatch:return((e,t)=>Ys(e.innerType._def,t))(e,r);case dr.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return Ys(e.in._def,t);if("output"===t.pipeStrategy)return Ys(e.out._def,t);const r=Ys(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[r,Ys(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]})].filter((e=>void 0!==e))}})(e,r);case dr.ZodFunction:case dr.ZodVoid:case dr.ZodSymbol:default:return}};function Ys(e,t,r=!1){const a=t.seen.get(e);if(t.override){const n=t.override?.(e,t,a,r);if(n!==xs)return n}if(a&&!r){const e=Gs(a,t);if(void 0!==e)return e}const n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);const s=Hs(e,e.typeName,t),o="function"==typeof s?Ys(s(),t):s;if(o&&Qs(e,t,o),t.postProcess){const r=t.postProcess(o,e,t);return n.jsonSchema=o,r}return n.jsonSchema=o,o}const Gs=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Xs(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every(((e,r)=>t.currentPath[r]===e))?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},Xs=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},Qs=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),eo=(e,t)=>{const r=(e=>{const t=(e=>"string"==typeof e?{...ws,name:e}:{...ws,...e})(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map((([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}])))}})(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce(((e,[t,a])=>({...e,[t]:Ys(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}})),{}):void 0,n="string"==typeof t?t:"title"===t?.nameStrategy?void 0:t?.name,s=Ys(e._def,void 0===n?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??{},o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(s.title=o);const i=void 0===n?a?{...s,[r.definitionPath]:a}:s:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...a,[n]:s}};return"jsonSchema7"===r.target?i.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"!==r.target&&"openAi"!==r.target||(i.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function to(e){const t=["ROOT"];let r=-1,a=null;function n(e,n,s){switch(e){case'"':r=n,t.pop(),t.push(s),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=n,a=n,t.pop(),t.push(s),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=n,t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"{":r=n,t.pop(),t.push(s),t.push("INSIDE_OBJECT_START");break;case"[":r=n,t.pop(),t.push(s),t.push("INSIDE_ARRAY_START")}}function s(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function o(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let i=0;i<e.length;i++){const l=e[i];switch(t[t.length-1]){case"ROOT":n(l,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":n(l,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(l,i);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=i}break;case"INSIDE_ARRAY_START":"]"===l?(r=i,t.pop()):(r=i,n(l,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=i,t.pop();break;default:r=i}break;case"INSIDE_ARRAY_AFTER_COMMA":n(l,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=i;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{const n=e.substring(a,i+1);"false".startsWith(n)||"true".startsWith(n)||"null".startsWith(n)?r=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?s(l,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&o(l,i));break}}}let i=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{const t=e.substring(a,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return i}[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"4",name:"assistant_message",parse:e=>{if(!(null!=e&&"object"==typeof e&&"id"in e&&"role"in e&&"content"in e&&"string"==typeof e.id&&"string"==typeof e.role&&"assistant"===e.role&&Array.isArray(e.content)&&e.content.every((e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},{code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},{code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}}].map((e=>e.code));var ro=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw new Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data||!("mimeType"in e)||"string"!=typeof e.mimeType)throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}];function ao(e,t){const r=ro.find((t=>t.name===e));if(!r)throw new Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}\n`}Object.fromEntries(ro.map((e=>[e.code,e]))),Object.fromEntries(ro.map((e=>[e.name,e.code]))),ro.map((e=>e.code)),"\n".charCodeAt(0),"\n".charCodeAt(0);var no=Symbol.for("vercel.ai.schema");function so(e){return"object"==typeof(t=e)&&null!==t&&no in t&&!0===t[no]&&"jsonSchema"in t&&"validate"in t?e:function(e,t){var r;const a=null!=(r=null==t?void 0:t.useReferences)&&r;return function(e,{validate:t}={}){return{[no]:!0,_type:void 0,[gs]:!0,jsonSchema:e,validate:t}}(eo(e,{$refStrategy:a?"root":"none",target:"jsonSchema7"}),{validate:t=>{const r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}(e);var t}var oo=Object.defineProperty,io=(e,t)=>{for(var r in t)oo(e,r,{get:t[r],enumerable:!0})};function lo(e,{contentType:t,dataStreamVersion:r}){const a=new Headers(null!=e?e:{});return a.has("Content-Type")||a.set("Content-Type",t),void 0!==r&&a.set("X-Vercel-AI-Data-Stream",r),a}function uo(e,{contentType:t,dataStreamVersion:r}){const a={};if(null!=e)for(const[t,r]of Object.entries(e))a[t]=r;return null==a["Content-Type"]&&(a["Content-Type"]=t),void 0!==r&&(a["X-Vercel-AI-Data-Stream"]=r),a}function co({response:e,status:t,statusText:r,headers:a,stream:n}){e.writeHead(null!=t?t:200,r,a);const s=n.getReader();(async()=>{try{for(;;){const{done:t,value:r}=await s.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}var po,mo="AI_InvalidArgumentError",ho=`vercel.ai.error.${mo}`,fo=Symbol.for(ho),go=class extends ka{constructor({parameter:e,value:t,message:r}){super({name:mo,message:`Invalid argument for parameter ${e}: ${r}`}),this[po]=!0,this.parameter=e,this.value=t}static isInstance(e){return ka.hasMarker(e,ho)}};po=fo;var yo,vo="AI_RetryError",_o=`vercel.ai.error.${vo}`,bo=Symbol.for(_o),xo=class extends ka{constructor({message:e,reason:t,errors:r}){super({name:vo,message:e}),this[yo]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return ka.hasMarker(e,_o)}};yo=bo;var wo=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>ko(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function ko(e,{maxRetries:t,delayInMs:r,backoffFactor:a},n=[]){try{return await e()}catch(s){if(function(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}(s))throw s;if(0===t)throw s;const o=function(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}(s),i=[...n,s],l=i.length;if(l>t)throw new xo({message:`Failed after ${l} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:i});if(s instanceof Error&&Ea.isInstance(s)&&!0===s.isRetryable&&l<=t)return await async function(e){return null==e?Promise.resolve():new Promise((t=>setTimeout(t,e)))}(r),ko(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},i);if(1===l)throw s;throw new xo({message:`Failed after ${l} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:i})}}function To({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new go({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new go({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const t=null!=e?e:2;return{maxRetries:t,retry:wo({maxRetries:t})}}function So({operationId:e,telemetry:t}){return{"operation.name":`${e}${null!=(null==t?void 0:t.functionId)?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function Io({model:e,settings:t,telemetry:r,headers:a}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce(((e,[t,r])=>(e[`ai.settings.${t}`]=r,e)),{}),...Object.entries(null!=(n=null==r?void 0:r.metadata)?n:{}).reduce(((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e)),{}),...Object.entries(null!=a?a:{}).reduce(((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e)),{})}}var Eo={startSpan:()=>Ao,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(Ao):"function"==typeof r?r(Ao):"function"==typeof a?a(Ao):void 0},Ao={spanContext:()=>Co,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},Co={traceId:"",spanId:"",traceFlags:0};function Ro({isEnabled:e=!1,tracer:t}={}){return e?t||Kn.getTracer("ai"):Eo}function No({name:e,tracer:t,attributes:r,fn:a,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},(async e=>{try{const t=await a(e);return n&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Fn.ERROR,message:t.message})):e.setStatus({code:Fn.ERROR})}finally{e.end()}throw t}}))}function Oo({telemetry:e,attributes:t}){return!0!==(null==e?void 0:e.isEnabled)?{}:Object.entries(t).reduce(((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if(!1===(null==e?void 0:e.recordInputs))return t;const n=a.input();return void 0===n?t:{...t,[r]:n}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if(!1===(null==e?void 0:e.recordOutputs))return t;const n=a.output();return void 0===n?t:{...t,[r]:n}}return{...t,[r]:a}}),{})}Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var jo=class{constructor({data:e,mimeType:t}){const r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t}get base64(){return null==this.base64Data&&(this.base64Data=rn(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=tn(this.base64Data)),this.uint8ArrayData}},Po=class extends jo{constructor(e){super(e),this.type="file"}},Mo=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}];var $o,Zo="AI_NoObjectGeneratedError",Do=`vercel.ai.error.${Zo}`,Fo=Symbol.for(Do),qo=class extends ka{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:n}){super({name:Zo,message:e,cause:t}),this[$o]=!0,this.text=r,this.response=a,this.usage=n}static isInstance(e){return ka.hasMarker(e,Do)}};$o=Fo;var Lo,Uo="AI_DownloadError",Bo=`vercel.ai.error.${Uo}`,Vo=Symbol.for(Bo),zo=class extends ka{constructor({url:e,statusCode:t,statusText:r,cause:a,message:n=(null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`)}){super({name:Uo,message:n,cause:a}),this[Lo]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return ka.hasMarker(e,Bo)}};async function Jo({url:e,fetchImplementation:t=fetch}){var r;const a=e.toString();try{const e=await t(a);if(!e.ok)throw new zo({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(r=e.headers.get("content-type"))?r:void 0}}catch(e){if(zo.isInstance(e))throw e;throw new zo({url:a,cause:e})}}Lo=Vo;var Ko,Wo="AI_InvalidDataContentError",Ho=`vercel.ai.error.${Wo}`,Yo=Symbol.for(Ho),Go=class extends ka{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:Wo,message:r,cause:t}),this[Ko]=!0,this.content=e}static isInstance(e){return ka.hasMarker(e,Ho)}};Ko=Yo;var Xo=Wr.union([Wr.string(),Wr.instanceof(Uint8Array),Wr.instanceof(ArrayBuffer),Wr.custom((e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r}),{message:"Must be a Buffer"})]);function Qo(e){return"string"==typeof e?e:e instanceof ArrayBuffer?rn(new Uint8Array(e)):rn(e)}function ei(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return tn(e)}catch(t){throw new Go({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new Go({content:e})}function ti(e){try{return(new TextDecoder).decode(e)}catch(e){throw new Error("Error decoding Uint8Array to text")}}var ri,ai="AI_InvalidMessageRoleError",ni=`vercel.ai.error.${ai}`,si=Symbol.for(ni),oi=class extends ka{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:ai,message:t}),this[ri]=!0,this.role=e}static isInstance(e){return ka.hasMarker(e,ni)}};async function ii({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=Jo}){const n=await async function(e,t,r,a){const n=e.filter((e=>"user"===e.role)).map((e=>e.content)).filter((e=>Array.isArray(e))).flat().filter((e=>"image"===e.type||"file"===e.type)).filter((e=>!("image"===e.type&&!0===r))).map((e=>"image"===e.type?e.image:e.data)).map((e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e)).filter((e=>e instanceof URL)).filter((e=>!a(e))),s=await Promise.all(n.map((async e=>({url:e,data:await t({url:e})}))));return Object.fromEntries(s.map((({url:e,data:t})=>[e.toString(),t])))}(e.messages,a,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map((e=>function(e,t){var r,a,n,s,o,i;const l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":return"string"==typeof e.content?{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata}:{role:"user",content:e.content.map((e=>function(e,t){var r,a,n,s;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};let o,i,l,u=e.mimeType;const c=e.type;switch(c){case"image":o=e.image;break;case"file":o=e.data;break;default:throw new Error(`Unsupported part type: ${c}`)}try{i="string"==typeof o?new URL(o):o}catch(e){i=o}if(i instanceof URL)if("data:"===i.protocol){const{mimeType:e,base64Content:t}=function(e){try{const[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(i.toString());if(null==e||null==t)throw new Error(`Invalid data URL format in part ${c}`);u=e,l=ei(t)}else{const e=t[i.toString()];e?(l=e.data,null!=u||(u=e.mimeType)):l=i}else l=ei(i);switch(c){case"image":return l instanceof Uint8Array&&(u=null!=(a=function(e){for(const t of Mo)if("string"==typeof e?e.startsWith(t.base64Prefix):e.length>=t.bytesPrefix.length&&t.bytesPrefix.every(((t,r)=>e[r]===t)))return t.mimeType}(l))?a:u),{type:"image",image:l,mimeType:u,providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"file":if(null==u)throw new Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?Qo(l):l,filename:e.filename,mimeType:u,providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata}}}(e,t))).filter((e=>"text"!==e.type||""!==e.text)),providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"assistant":return"string"==typeof e.content?{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata}:{role:"assistant",content:e.content.filter((e=>"text"!==e.type||""!==e.text)).map((e=>{var t;const r=null!=(t=e.providerOptions)?t:e.experimental_providerMetadata;switch(e.type){case"file":return{type:"file",data:e.data instanceof URL?e.data:Qo(e.data),filename:e.filename,mimeType:e.mimeType,providerMetadata:r};case"reasoning":return{type:"reasoning",text:e.text,signature:e.signature,providerMetadata:r};case"redacted-reasoning":return{type:"redacted-reasoning",data:e.data,providerMetadata:r};case"text":return{type:"text",text:e.text,providerMetadata:r};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args,providerMetadata:r}}})),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map((e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}})),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};default:throw new oi({role:l})}}(e,n)))]}function li({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:o,seed:i}){if(null!=e){if(!Number.isInteger(e))throw new go({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new go({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new go({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new go({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new go({parameter:"topK",value:a,message:"topK must be a number"});if(null!=n&&"number"!=typeof n)throw new go({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(null!=s&&"number"!=typeof s)throw new go({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new go({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:null!=o&&o.length>0?o:void 0,seed:i}}function ui(e){var t,r,a;const n=[];for(const s of e){let e;try{e=new URL(s.url)}catch(e){throw new Error(`Invalid URL: ${s.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=s.contentType)?void 0:t.startsWith("image/"))n.push({type:"image",image:e});else{if(!s.contentType)throw new Error("If the attachment is not an image, it must specify a content type");n.push({type:"file",data:e,mimeType:s.contentType})}break;case"data:":{let e,t,o;try{[e,t]=s.url.split(","),o=e.split(";")[0].split(":")[1]}catch(e){throw new Error(`Error processing data URL: ${s.url}`)}if(null==o||null==t)throw new Error(`Invalid data URL format: ${s.url}`);if(null==(r=s.contentType)?void 0:r.startsWith("image/"))n.push({type:"image",image:ei(t)});else if(null==(a=s.contentType)?void 0:a.startsWith("text/"))n.push({type:"text",text:ti(ei(t))});else{if(!s.contentType)throw new Error("If the attachment is not an image or text, it must specify a content type");n.push({type:"file",data:t,mimeType:s.contentType})}break}default:throw new Error(`Unsupported URL protocol: ${e.protocol}`)}}return n}ri=si;var ci,di="AI_MessageConversionError",pi=`vercel.ai.error.${di}`,mi=Symbol.for(pi),hi=class extends ka{constructor({originalMessage:e,message:t}){super({name:di,message:t}),this[ci]=!0,this.originalMessage=e}static isInstance(e){return ka.hasMarker(e,pi)}};function fi(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}ci=mi;var gi=Wr.lazy((()=>Wr.union([Wr.null(),Wr.string(),Wr.number(),Wr.boolean(),Wr.record(Wr.string(),gi),Wr.array(gi)]))),yi=Wr.record(Wr.string(),Wr.record(Wr.string(),gi)),vi=Wr.array(Wr.union([Wr.object({type:Wr.literal("text"),text:Wr.string()}),Wr.object({type:Wr.literal("image"),data:Wr.string(),mimeType:Wr.string().optional()})])),_i=Wr.object({type:Wr.literal("text"),text:Wr.string(),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),bi=Wr.object({type:Wr.literal("image"),image:Wr.union([Xo,Wr.instanceof(URL)]),mimeType:Wr.string().optional(),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),xi=Wr.object({type:Wr.literal("file"),data:Wr.union([Xo,Wr.instanceof(URL)]),filename:Wr.string().optional(),mimeType:Wr.string(),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),wi=Wr.object({type:Wr.literal("reasoning"),text:Wr.string(),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),ki=Wr.object({type:Wr.literal("redacted-reasoning"),data:Wr.string(),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),Ti=Wr.object({type:Wr.literal("tool-call"),toolCallId:Wr.string(),toolName:Wr.string(),args:Wr.unknown(),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),Si=Wr.object({type:Wr.literal("tool-result"),toolCallId:Wr.string(),toolName:Wr.string(),result:Wr.unknown(),content:vi.optional(),isError:Wr.boolean().optional(),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),Ii=Wr.object({role:Wr.literal("system"),content:Wr.string(),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),Ei=Wr.object({role:Wr.literal("user"),content:Wr.union([Wr.string(),Wr.array(Wr.union([_i,bi,xi]))]),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),Ai=Wr.object({role:Wr.literal("assistant"),content:Wr.union([Wr.string(),Wr.array(Wr.union([_i,xi,wi,ki,Ti]))]),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),Ci=Wr.object({role:Wr.literal("tool"),content:Wr.array(Si),providerOptions:yi.optional(),experimental_providerMetadata:yi.optional()}),Ri=Wr.union([Ii,Ei,Ai,Ci]);function Ni({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new Da({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new Da({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new Da({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new Da({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){const r=function(e){if(!Array.isArray(e))return"other";if(0===e.length)return"messages";const t=e.map(fi);return t.some((e=>"has-ui-specific-parts"===e))?"ui-messages":t.every((e=>"has-core-specific-parts"===e||"message"===e))?"messages":"other"}(e.messages);if("other"===r)throw new Da({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});const a="ui-messages"===r?function(e,t){var r,a;const n=null!=(r=null==t?void 0:t.tools)?r:{},s=[];for(let t=0;t<e.length;t++){const r=e[t],o=t===e.length-1,{role:i,content:l,experimental_attachments:u}=r;switch(i){case"system":s.push({role:"system",content:l});break;case"user":s.push({role:"user",content:u?[{type:"text",text:l},...ui(u)]:l});break;case"assistant":{if(null!=r.parts){let e=function(){const e=[];for(const t of i)switch(t.type){case"file":case"text":e.push(t);break;case"reasoning":for(const r of t.details)switch(r.type){case"text":e.push({type:"reasoning",text:r.text,signature:r.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:r.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw new Error(`Unsupported part: ${t}`)}s.push({role:"assistant",content:e});const a=i.filter((e=>"tool-invocation"===e.type)).map((e=>e.toolInvocation));a.length>0&&s.push({role:"tool",content:a.map((e=>{if(!("result"in e))throw new hi({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});const{toolCallId:t,toolName:a,result:s}=e,o=n[a];return null!=(null==o?void 0:o.experimental_toToolResultContent)?{type:"tool-result",toolCallId:t,toolName:a,result:o.experimental_toToolResultContent(s),experimental_content:o.experimental_toToolResultContent(s)}:{type:"tool-result",toolCallId:t,toolName:a,result:s}}))}),i=[],o=!1,t++},t=0,o=!1,i=[];for(const n of r.parts)switch(n.type){case"text":o&&e(),i.push(n);break;case"file":case"reasoning":i.push(n);break;case"tool-invocation":(null!=(a=n.toolInvocation.step)?a:0)!==t&&e(),i.push(n),o=!0}e();break}const e=r.toolInvocations;if(null==e||0===e.length){s.push({role:"assistant",content:l});break}const t=e.reduce(((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)}),0);for(let a=0;a<=t;a++){const t=e.filter((e=>{var t;return(null!=(t=e.step)?t:0)===a}));0!==t.length&&(s.push({role:"assistant",content:[...o&&l&&0===a?[{type:"text",text:l}]:[],...t.map((({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r})))]}),s.push({role:"tool",content:t.map((e=>{if(!("result"in e))throw new hi({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});const{toolCallId:t,toolName:a,result:s}=e,o=n[a];return null!=(null==o?void 0:o.experimental_toToolResultContent)?{type:"tool-result",toolCallId:t,toolName:a,result:o.experimental_toToolResultContent(s),experimental_content:o.experimental_toToolResultContent(s)}:{type:"tool-result",toolCallId:t,toolName:a,result:s}}))}))}l&&!o&&s.push({role:"assistant",content:l});break}case"data":break;default:throw new hi({originalMessage:r,message:`Unsupported role: ${i}`})}}return s}(e.messages,{tools:t}):e.messages,n=Ga({value:a,schema:Wr.array(Ri)});if(!n.success)throw new Da({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:n.error});return{type:"messages",messages:a,system:e.system}}throw new Error("unreachable")}function Oi({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function ji(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}function Pi(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{const e=t.getReader();return{async next(){const{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}Ha({prefix:"aiobj",size:24});var Mi=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise(((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t}))),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&(null==(t=this._reject)||t.call(this,e))}};function $i(){let e,t;return{promise:new Promise(((r,a)=>{e=r,t=a})),resolve:e,reject:t}}function Zi(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()}Ha({prefix:"aiobj",size:24});var Di,Fi="AI_NoOutputSpecifiedError",qi=`vercel.ai.error.${Fi}`,Li=Symbol.for(qi),Ui=class extends ka{constructor({message:e="No output specified."}={}){super({name:Fi,message:e}),this[Di]=!0}static isInstance(e){return ka.hasMarker(e,qi)}};Di=Li;var Bi,Vi="AI_ToolExecutionError",zi=`vercel.ai.error.${Vi}`,Ji=Symbol.for(zi),Ki=class extends ka{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:n=`Error executing tool ${t}: ${Aa(a)}`}){super({name:Vi,message:n,cause:a}),this[Bi]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return ka.hasMarker(e,zi)}};function Wi({tools:e,toolChoice:t,activeTools:r}){return null!=(a=e)&&Object.keys(a).length>0?{tools:(null!=r?Object.entries(e).filter((([e])=>r.includes(e))):Object.entries(e)).map((([e,t])=>{const r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:so(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw new Error(`Unsupported tool type: ${r}`)}})),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0};var a}Bi=Ji;var Hi=/^([\s\S]*?)(\s+)(\S*)$/;function Yi(e){const t=e.match(Hi);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}function Gi(e){const t=Yi(e);return t?t.prefix+t.whitespace:e}var Xi,Qi="AI_InvalidToolArgumentsError",el=`vercel.ai.error.${Qi}`,tl=Symbol.for(el),rl=class extends ka{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${Aa(r)}`}){super({name:Qi,message:a,cause:r}),this[Xi]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return ka.hasMarker(e,el)}};Xi=tl;var al,nl="AI_NoSuchToolError",sl=`vercel.ai.error.${nl}`,ol=Symbol.for(sl),il=class extends ka{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:nl,message:r}),this[al]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return ka.hasMarker(e,sl)}};al=ol;var ll,ul="AI_ToolCallRepairError",cl=`vercel.ai.error.${ul}`,dl=Symbol.for(cl),pl=class extends ka{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${Aa(e)}`}){super({name:ul,message:r,cause:e}),this[ll]=!0,this.originalError=t}static isInstance(e){return ka.hasMarker(e,cl)}};async function ml({toolCall:e,tools:t,repairToolCall:r,system:a,messages:n}){if(null==t)throw new il({toolName:e.toolName});try{return await hl({toolCall:e,tools:t})}catch(s){if(null==r||!il.isInstance(s)&&!rl.isInstance(s))throw s;let o=null;try{o=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>so(t[e].parameters).jsonSchema,system:a,messages:n,error:s})}catch(e){throw new pl({cause:e,originalError:s})}if(null==o)throw s;return await hl({toolCall:o,tools:t})}}async function hl({toolCall:e,tools:t}){const r=e.toolName,a=t[r];if(null==a)throw new il({toolName:e.toolName,availableTools:Object.keys(t)});const n=so(a.parameters),s=""===e.args.trim()?Ga({value:{},schema:n}):Xa({text:e.args,schema:n});if(!1===s.success)throw new rl({toolName:r,toolArgs:e.args,cause:s.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:s.value}}function fl(e){const t=e.filter((e=>"text"===e.type)).map((e=>e.text)).join("");return t.length>0?t:void 0}function gl({text:e="",files:t,reasoning:r,tools:a,toolCalls:n,toolResults:s,messageId:o,generateMessageId:i}){const l=[];return l.push({role:"assistant",content:[...r.map((e=>"text"===e.type?{...e,type:"reasoning"}:{...e,type:"redacted-reasoning"})),...t.map((e=>({type:"file",data:e.base64,mimeType:e.mimeType}))),{type:"text",text:e},...n],id:o}),s.length>0&&l.push({role:"tool",id:i(),content:s.map((e=>{const t=a[e.toolName];return null!=(null==t?void 0:t.experimental_toToolResultContent)?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:t.experimental_toToolResultContent(e.result),experimental_content:t.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}}))}),l}ll=dl;var yl=Ha({prefix:"aitxt",size:24}),vl=Ha({prefix:"msg",size:24});async function _l({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:s,maxRetries:o,abortSignal:i,headers:l,maxSteps:u=1,experimental_generateMessageId:c=vl,experimental_output:d,experimental_continueSteps:p=!1,experimental_telemetry:m,experimental_providerMetadata:h,providerOptions:f=h,experimental_activeTools:g,experimental_repairToolCall:y,_internal:{generateId:v=yl,currentDate:_=()=>new Date}={},onStepFinish:b,...x}){var w;if(u<1)throw new go({parameter:"maxSteps",value:u,message:"maxSteps must be at least 1"});const{maxRetries:k,retry:T}=To({maxRetries:o}),S=Io({model:e,telemetry:m,headers:l,settings:{...x,maxRetries:k}}),I=Ni({prompt:{system:null!=(w=null==d?void 0:d.injectIntoSystemPrompt({system:a,model:e}))?w:a,prompt:n,messages:s},tools:t}),E=Ro(m);return No({name:"ai.generateText",attributes:Oo({telemetry:m,attributes:{...So({operationId:"ai.generateText",telemetry:m}),...S,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:n,messages:s})},"ai.settings.maxSteps":u}}),tracer:E,fn:async n=>{var s,o,h,w,k,A,C,R,N,O,j;const P={type:"regular",...Wi({tools:t,toolChoice:r,activeTools:g})},M=li(x);let $,Z=[],D=[],F=[],q=0;const L=[];let U="";const B=[],V=[];let z={completionTokens:0,promptTokens:0,totalTokens:0},J="initial";do{const r=0===q?I.type:"messages",n=[...I.messages,...L],g=await ii({prompt:{type:r,system:I.system,messages:n},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(s=e.supportsUrl)?void 0:s.bind(e)});$=await T((()=>No({name:"ai.generateText.doGenerate",attributes:Oo({telemetry:m,attributes:{...So({operationId:"ai.generateText.doGenerate",telemetry:m}),...S,"ai.prompt.format":{input:()=>r},"ai.prompt.messages":{input:()=>JSON.stringify(g)},"ai.prompt.tools":{input:()=>{var e;return null==(e=P.tools)?void 0:e.map((e=>JSON.stringify(e)))}},"ai.prompt.toolChoice":{input:()=>null!=P.toolChoice?JSON.stringify(P.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":x.frequencyPenalty,"gen_ai.request.max_tokens":x.maxTokens,"gen_ai.request.presence_penalty":x.presencePenalty,"gen_ai.request.stop_sequences":x.stopSequences,"gen_ai.request.temperature":x.temperature,"gen_ai.request.top_k":x.topK,"gen_ai.request.top_p":x.topP}}),tracer:E,fn:async t=>{var a,n,s,o,u,c;const p=await e.doGenerate({mode:P,...M,inputFormat:r,responseFormat:null==d?void 0:d.responseFormat({model:e}),prompt:g,providerMetadata:f,abortSignal:i,headers:l}),h={id:null!=(n=null==(a=p.response)?void 0:a.id)?n:v(),timestamp:null!=(o=null==(s=p.response)?void 0:s.timestamp)?o:_(),modelId:null!=(c=null==(u=p.response)?void 0:u.modelId)?c:e.modelId};return t.setAttributes(Oo({telemetry:m,attributes:{"ai.response.finishReason":p.finishReason,"ai.response.text":{output:()=>p.text},"ai.response.toolCalls":{output:()=>JSON.stringify(p.toolCalls)},"ai.response.id":h.id,"ai.response.model":h.modelId,"ai.response.timestamp":h.timestamp.toISOString(),"ai.usage.promptTokens":p.usage.promptTokens,"ai.usage.completionTokens":p.usage.completionTokens,"gen_ai.response.finish_reasons":[p.finishReason],"gen_ai.response.id":h.id,"gen_ai.response.model":h.modelId,"gen_ai.usage.input_tokens":p.usage.promptTokens,"gen_ai.usage.output_tokens":p.usage.completionTokens}})),{...p,response:h}}}))),Z=await Promise.all((null!=(o=$.toolCalls)?o:[]).map((e=>ml({toolCall:e,tools:t,repairToolCall:y,system:a,messages:n})))),D=null==t?[]:await bl({toolCalls:Z,tools:t,tracer:E,telemetry:m,messages:n,abortSignal:i});const N=Oi($.usage);z=ji(z,N);let O="done";++q<u&&(p&&"length"===$.finishReason&&0===Z.length?O="continue":Z.length>0&&D.length===Z.length&&(O="tool-result"));const j=null!=(h=$.text)?h:"",K="continue"===J&&U.trimEnd()!==U?j.trimStart():j,W="continue"===O?Gi(K):K;if(U="continue"===O||"continue"===J?U+W:W,F=wl($.reasoning),B.push(...null!=(w=$.sources)?w:[]),"continue"===J){const e=L[L.length-1];"string"==typeof e.content?e.content+=W:e.content.push({text:W,type:"text"})}else L.push(...gl({text:U,files:kl($.files),reasoning:wl($.reasoning),tools:null!=t?t:{},toolCalls:Z,toolResults:D,messageId:c(),generateMessageId:c}));const H={stepType:J,text:W,reasoning:fl(F),reasoningDetails:F,files:kl($.files),sources:null!=(k=$.sources)?k:[],toolCalls:Z,toolResults:D,finishReason:$.finishReason,usage:N,warnings:$.warnings,logprobs:$.logprobs,request:null!=(A=$.request)?A:{},response:{...$.response,headers:null==(C=$.rawResponse)?void 0:C.headers,body:null==(R=$.rawResponse)?void 0:R.body,messages:structuredClone(L)},providerMetadata:$.providerMetadata,experimental_providerMetadata:$.providerMetadata,isContinued:"continue"===O};V.push(H),await(null==b?void 0:b(H)),J=O}while("done"!==J);return n.setAttributes(Oo({telemetry:m,attributes:{"ai.response.finishReason":$.finishReason,"ai.response.text":{output:()=>$.text},"ai.response.toolCalls":{output:()=>JSON.stringify($.toolCalls)},"ai.usage.promptTokens":$.usage.promptTokens,"ai.usage.completionTokens":$.usage.completionTokens}})),new xl({text:U,files:kl($.files),reasoning:fl(F),reasoningDetails:F,sources:B,outputResolver:()=>{if(null==d)throw new Ui;return d.parseOutput({text:U},{response:$.response,usage:z})},toolCalls:Z,toolResults:D,finishReason:$.finishReason,usage:z,warnings:$.warnings,request:null!=(N=$.request)?N:{},response:{...$.response,headers:null==(O=$.rawResponse)?void 0:O.headers,body:null==(j=$.rawResponse)?void 0:j.body,messages:L},logprobs:$.logprobs,steps:V,providerMetadata:$.providerMetadata})}})}async function bl({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:n,abortSignal:s}){return(await Promise.all(e.map((async({toolCallId:e,toolName:o,args:i})=>{const l=t[o];if(null==(null==l?void 0:l.execute))return;const u=await No({name:"ai.toolCall",attributes:Oo({telemetry:a,attributes:{...So({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":o,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(i)}}}),tracer:r,fn:async t=>{try{const r=await l.execute(i,{toolCallId:e,messages:n,abortSignal:s});try{t.setAttributes(Oo({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return r}catch(t){throw new Ki({toolCallId:e,toolName:o,toolArgs:i,cause:t})}}});return{type:"tool-result",toolCallId:e,toolName:o,args:i,result:u}})))).filter((e=>null!=e))}var xl=class{constructor(e){this.text=e.text,this.files=e.files,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function wl(e){return null==e?[]:"string"==typeof e?[{type:"text",text:e}]:e}function kl(e){var t;return null!=(t=null==e?void 0:e.map((e=>new jo(e))))?t:[]}io({},{object:()=>Rl,text:()=>Cl});var Tl,Sl="AI_InvalidStreamPartError",Il=`vercel.ai.error.${Sl}`,El=Symbol.for(Il),Al=class extends ka{constructor({chunk:e,message:t}){super({name:Sl,message:t}),this[Tl]=!0,this.chunk=e}static isInstance(e){return ka.hasMarker(e,Il)}};Tl=El;Symbol.for("vercel.ai.error.AI_MCPClientError");var Cl=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),Rl=({schema:e})=>{const t=so(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:function({prompt:e,schema:t,schemaPrefix:r=(null!=t?"JSON schema:":void 0),schemaSuffix:a=(null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON.")}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,a].filter((e=>null!=e)).join("\n")}({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){const t=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=vs({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=vs({text:to(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{const e=t.state;throw new Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){const a=Xa({text:e});if(!a.success)throw new qo({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage});const n=Ga({value:a.value,schema:t});if(!n.success)throw new qo({message:"No object generated: response did not match schema.",cause:n.error,text:e,response:r.response,usage:r.usage});return n.value}}};function Nl(e,t){const r=e.getReader(),a=t.getReader();let n,s,o=!1,i=!1;async function l(e){try{null==n&&(n=r.read());const t=await n;n=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==s&&(s=a.read());const t=await s;s=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(o)return void await u(e);if(i)return void await l(e);null==n&&(n=r.read()),null==s&&(s=a.read());const{result:t,reader:c}=await Promise.race([n.then((e=>({result:e,reader:r}))),s.then((e=>({result:e,reader:a})))]);t.done||e.enqueue(t.value),c===r?(n=void 0,t.done&&(await u(e),o=!0)):(s=void 0,t.done&&(i=!0,await l(e)))}catch(t){e.error(t)}},cancel(){r.cancel(),a.cancel()}})}var Ol=Ha({prefix:"aitxt",size:24}),jl=Ha({prefix:"msg",size:24});function Pl({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:s,maxRetries:o,abortSignal:i,headers:l,maxSteps:u=1,experimental_generateMessageId:c=jl,experimental_output:d,experimental_continueSteps:p=!1,experimental_telemetry:m,experimental_providerMetadata:h,providerOptions:f=h,experimental_toolCallStreaming:g=!1,toolCallStreaming:y=g,experimental_activeTools:v,experimental_repairToolCall:_,experimental_transform:b,onChunk:x,onError:w,onFinish:k,onStepFinish:T,_internal:{now:S=Zi,generateId:I=Ol,currentDate:E=()=>new Date}={},...A}){return new Ml({model:e,telemetry:m,headers:l,settings:A,maxRetries:o,abortSignal:i,system:a,prompt:n,messages:s,tools:t,toolChoice:r,toolCallStreaming:y,transforms:(C=b,void 0===C?[]:Array.isArray(C)?C:[C]),activeTools:v,repairToolCall:_,maxSteps:u,output:d,continueSteps:p,providerOptions:f,onChunk:x,onError:w,onFinish:k,onStepFinish:T,now:S,currentDate:E,generateId:I,generateMessageId:c});var C}var Ml=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:n,abortSignal:s,system:o,prompt:i,messages:l,tools:u,toolChoice:c,toolCallStreaming:d,transforms:p,activeTools:m,repairToolCall:h,maxSteps:f,output:g,continueSteps:y,providerOptions:v,now:_,currentDate:b,generateId:x,generateMessageId:w,onChunk:k,onError:T,onFinish:S,onStepFinish:I}){var E;if(this.warningsPromise=new Mi,this.usagePromise=new Mi,this.finishReasonPromise=new Mi,this.providerMetadataPromise=new Mi,this.textPromise=new Mi,this.reasoningPromise=new Mi,this.reasoningDetailsPromise=new Mi,this.sourcesPromise=new Mi,this.filesPromise=new Mi,this.toolCallsPromise=new Mi,this.toolResultsPromise=new Mi,this.requestPromise=new Mi,this.responsePromise=new Mi,this.stepsPromise=new Mi,f<1)throw new go({parameter:"maxSteps",value:f,message:"maxSteps must be at least 1"});this.output=g;let A,C="",R="",N="",O=[],j=[],P=[];const M=[],$={id:x(),timestamp:b(),modelId:e.modelId,messages:[]};let Z,D,F=[],q=[],L="initial";const U=[];let B;const V=new TransformStream({async transform(e,t){t.enqueue(e);const{part:r}=e;if("text-delta"!==r.type&&"reasoning"!==r.type&&"source"!==r.type&&"tool-call"!==r.type&&"tool-result"!==r.type&&"tool-call-streaming-start"!==r.type&&"tool-call-delta"!==r.type||await(null==k?void 0:k({chunk:r})),"error"===r.type&&await(null==T?void 0:T({error:r.error})),"text-delta"===r.type&&(C+=r.textDelta,R+=r.textDelta,N+=r.textDelta),"reasoning"===r.type&&(null==A?(A={type:"text",text:r.textDelta},O.push(A)):A.text+=r.textDelta),"reasoning-signature"===r.type){if(null==A)throw new ka({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});A.signature=r.signature,A=void 0}if("redacted-reasoning"===r.type&&O.push({type:"redacted",data:r.data}),"file"===r.type&&j.push(r),"source"===r.type&&(M.push(r.source),P.push(r.source)),"tool-call"===r.type&&F.push(r),"tool-result"===r.type&&q.push(r),"step-finish"===r.type){const e=gl({text:R,files:j,reasoning:O,tools:null!=u?u:{},toolCalls:F,toolResults:q,messageId:r.messageId,generateMessageId:w});let t="done";U.length+1<f&&(y&&"length"===r.finishReason&&0===F.length?t="continue":F.length>0&&q.length===F.length&&(t="tool-result"));const a={stepType:L,text:C,reasoning:fl(O),reasoningDetails:O,files:j,sources:P,toolCalls:F,toolResults:q,finishReason:r.finishReason,usage:r.usage,warnings:r.warnings,logprobs:r.logprobs,request:r.request,response:{...r.response,messages:[...$.messages,...e]},providerMetadata:r.experimental_providerMetadata,experimental_providerMetadata:r.experimental_providerMetadata,isContinued:r.isContinued};await(null==I?void 0:I(a)),U.push(a),F=[],q=[],C="",P=[],O=[],j=[],A=void 0,"done"!==t&&(L=t),"continue"!==t&&($.messages.push(...e),R="")}"finish"===r.type&&($.id=r.response.id,$.timestamp=r.response.timestamp,$.modelId=r.response.modelId,$.headers=r.response.headers,D=r.usage,Z=r.finishReason)},async flush(e){var r;try{if(0===U.length)return;const e=U[U.length-1];X.warningsPromise.resolve(e.warnings),X.requestPromise.resolve(e.request),X.responsePromise.resolve(e.response),X.toolCallsPromise.resolve(e.toolCalls),X.toolResultsPromise.resolve(e.toolResults),X.providerMetadataPromise.resolve(e.experimental_providerMetadata),X.reasoningPromise.resolve(e.reasoning),X.reasoningDetailsPromise.resolve(e.reasoningDetails);const a=null!=Z?Z:"unknown",n=null!=D?D:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};X.finishReasonPromise.resolve(a),X.usagePromise.resolve(n),X.textPromise.resolve(N),X.sourcesPromise.resolve(M),X.filesPromise.resolve(e.files),X.stepsPromise.resolve(U),await(null==S?void 0:S({finishReason:a,logprobs:void 0,usage:n,text:N,reasoning:e.reasoning,reasoningDetails:e.reasoningDetails,files:e.files,sources:e.sources,toolCalls:e.toolCalls,toolResults:e.toolResults,request:null!=(r=e.request)?r:{},response:e.response,warnings:e.warnings,providerMetadata:e.providerMetadata,experimental_providerMetadata:e.experimental_providerMetadata,steps:U})),B.setAttributes(Oo({telemetry:t,attributes:{"ai.response.finishReason":a,"ai.response.text":{output:()=>N},"ai.response.toolCalls":{output:()=>{var t;return(null==(t=e.toolCalls)?void 0:t.length)?JSON.stringify(e.toolCalls):void 0}},"ai.usage.promptTokens":n.promptTokens,"ai.usage.completionTokens":n.completionTokens}}))}catch(t){e.error(t)}finally{B.end()}}}),z=function(){let e=[],t=null,r=!1,a=$i();const n=async()=>{if(r&&0===e.length)null==t||t.close();else{if(0===e.length)return a=$i(),await a.promise,n();try{const{value:a,done:s}=await e[0].read();s?(e.shift(),e.length>0?await n():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(a){null==t||t.error(a),e.shift(),r&&0===e.length&&(null==t||t.close())}}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(const t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw new Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:()=>{r=!0,a.resolve(),e.forEach((e=>e.cancel())),e=[],null==t||t.close()}}}();this.addStream=z.addStream,this.closeStream=z.close;let J=z.stream;for(const e of p)J=J.pipeThrough(e({tools:u,stopStream(){z.terminate()}}));this.baseStream=J.pipeThrough(function(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t="",r="",a="";function n({controller:e,partialOutput:t}){e.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:t}),r=""}return new TransformStream({transform(s,o){if("step-finish"===s.type&&n({controller:o}),"text-delta"!==s.type)return void o.enqueue({part:s,partialOutput:void 0});t+=s.textDelta,r+=s.textDelta;const i=e.parsePartial({text:t});if(null!=i){const e=JSON.stringify(i.partial);e!==a&&(n({controller:o,partialOutput:i.partial}),a=e)}},flush(e){r.length>0&&n({controller:e})}})}(g)).pipeThrough(V);const{maxRetries:K,retry:W}=To({maxRetries:n}),H=Ro(t),Y=Io({model:e,telemetry:t,headers:r,settings:{...a,maxRetries:K}}),G=Ni({prompt:{system:null!=(E=null==g?void 0:g.injectIntoSystemPrompt({system:o,model:e}))?E:o,prompt:i,messages:l},tools:u}),X=this;No({name:"ai.streamText",attributes:Oo({telemetry:t,attributes:{...So({operationId:"ai.streamText",telemetry:t}),...Y,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:i,messages:l})},"ai.settings.maxSteps":f}}),tracer:H,endWhenDone:!1,fn:async n=>{B=n,await async function n({currentStep:i,responseMessages:l,usage:p,stepType:k,previousStepText:T,hasLeadingWhitespace:S,messageId:I}){var E;const A=0===l.length?G.type:"messages",C=[...G.messages,...l],R=await ii({prompt:{type:A,system:G.system,messages:C},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(E=e.supportsUrl)?void 0:E.bind(e)}),N={type:"regular",...Wi({tools:u,toolChoice:c,activeTools:m})},{result:{stream:O,warnings:j,rawResponse:P,request:M},doStreamSpan:$,startTimestampMs:Z}=await W((()=>No({name:"ai.streamText.doStream",attributes:Oo({telemetry:t,attributes:{...So({operationId:"ai.streamText.doStream",telemetry:t}),...Y,"ai.prompt.format":{input:()=>A},"ai.prompt.messages":{input:()=>JSON.stringify(R)},"ai.prompt.tools":{input:()=>{var e;return null==(e=N.tools)?void 0:e.map((e=>JSON.stringify(e)))}},"ai.prompt.toolChoice":{input:()=>null!=N.toolChoice?JSON.stringify(N.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.stop_sequences":a.stopSequences,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:H,endWhenDone:!1,fn:async t=>({startTimestampMs:_(),doStreamSpan:t,result:await e.doStream({mode:N,...li(a),inputFormat:A,responseFormat:null==g?void 0:g.responseFormat({model:e}),prompt:R,providerMetadata:v,abortSignal:s,headers:r})})}))),D=function({tools:e,generatorStream:t,toolCallStreaming:r,tracer:a,telemetry:n,system:s,messages:o,abortSignal:i,repairToolCall:l}){let u=null;const c=new ReadableStream({start(e){u=e}}),d={},p=new Set;let m,h=!1;function f(){h&&0===p.size&&(null!=m&&u.enqueue(m),u.close())}const g=new TransformStream({async transform(t,c){const h=t.type;switch(h){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":c.enqueue(t);break;case"file":c.enqueue(new Po({data:t.data,mimeType:t.mimeType}));break;case"tool-call-delta":r&&(d[t.toolCallId]||(c.enqueue({type:"tool-call-streaming-start",toolCallId:t.toolCallId,toolName:t.toolName}),d[t.toolCallId]=!0),c.enqueue({type:"tool-call-delta",toolCallId:t.toolCallId,toolName:t.toolName,argsTextDelta:t.argsTextDelta}));break;case"tool-call":try{const r=await ml({toolCall:t,tools:e,repairToolCall:l,system:s,messages:o});c.enqueue(r);const d=e[r.toolName];if(null!=d.execute){const e=fs();p.add(e),No({name:"ai.toolCall",attributes:Oo({telemetry:n,attributes:{...So({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":r.toolName,"ai.toolCall.id":r.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(r.args)}}}),tracer:a,fn:async t=>d.execute(r.args,{toolCallId:r.toolCallId,messages:o,abortSignal:i}).then((a=>{u.enqueue({...r,type:"tool-result",result:a}),p.delete(e),f();try{t.setAttributes(Oo({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}}),(t=>{u.enqueue({type:"error",error:new Ki({toolCallId:r.toolCallId,toolName:r.toolName,toolArgs:r.args,cause:t})}),p.delete(e),f()}))})}}catch(e){u.enqueue({type:"error",error:e})}break;case"finish":m={type:"finish",finishReason:t.finishReason,logprobs:t.logprobs,usage:Oi(t.usage),experimental_providerMetadata:t.providerMetadata};break;default:throw new Error(`Unhandled chunk type: ${h}`)}},flush(){h=!0,f()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),c.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:O,toolCallStreaming:d,tracer:H,telemetry:t,system:o,messages:C,repairToolCall:h,abortSignal:s}),F=null!=M?M:{},q=[],L=[],U=[],B=[];let V,z,J,K="unknown",Q={promptTokens:0,completionTokens:0,totalTokens:0},ee=!0,te="",re="continue"===k?T:"",ae={id:x(),timestamp:b(),modelId:e.modelId},ne="",se=!1,oe=!0,ie=!1;async function le({controller:e,chunk:t}){e.enqueue(t),te+=t.textDelta,re+=t.textDelta,se=!0,ie=t.textDelta.trimEnd()!==t.textDelta}X.addStream(D.pipeThrough(new TransformStream({async transform(e,t){var r,a,n;if(ee){const e=_()-Z;ee=!1,$.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),$.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"step-start",messageId:I,request:F,warnings:null!=j?j:[]})}if("text-delta"===e.type&&0===e.textDelta.length)return;const s=e.type;switch(s){case"text-delta":if(y){const r=oe&&S?e.textDelta.trimStart():e.textDelta;if(0===r.length)break;oe=!1,ne+=r;const a=Yi(ne);null!=a&&(ne=a.suffix,await le({controller:t,chunk:{type:"text-delta",textDelta:a.prefix+a.whitespace}}))}else await le({controller:t,chunk:e});break;case"reasoning":t.enqueue(e),null==V?(V={type:"text",text:e.textDelta},U.push(V)):V.text+=e.textDelta;break;case"reasoning-signature":if(t.enqueue(e),null==V)throw new Al({chunk:e,message:"reasoning-signature without reasoning"});V.signature=e.signature,V=void 0;break;case"redacted-reasoning":t.enqueue(e),U.push({type:"redacted",data:e.data});break;case"tool-call":t.enqueue(e),q.push(e);break;case"tool-result":t.enqueue(e),L.push(e);break;case"response-metadata":ae={id:null!=(r=e.id)?r:ae.id,timestamp:null!=(a=e.timestamp)?a:ae.timestamp,modelId:null!=(n=e.modelId)?n:ae.modelId};break;case"finish":{Q=e.usage,K=e.finishReason,z=e.experimental_providerMetadata,J=e.logprobs;const t=_()-Z;$.addEvent("ai.stream.finish"),$.setAttributes({"ai.response.msToFinish":t,"ai.response.avgCompletionTokensPerSecond":1e3*Q.completionTokens/t});break}case"file":B.push(e),t.enqueue(e);break;case"source":case"tool-call-streaming-start":case"tool-call-delta":t.enqueue(e);break;case"error":t.enqueue(e),K="error";break;default:throw new Error(`Unknown chunk type: ${s}`)}},async flush(e){const r=q.length>0?JSON.stringify(q):void 0;let a="done";i+1<f&&(y&&"length"===K&&0===q.length?a="continue":q.length>0&&L.length===q.length&&(a="tool-result")),y&&ne.length>0&&("continue"!==a||"continue"===k&&!se)&&(await le({controller:e,chunk:{type:"text-delta",textDelta:ne}}),ne="");try{$.setAttributes(Oo({telemetry:t,attributes:{"ai.response.finishReason":K,"ai.response.text":{output:()=>te},"ai.response.toolCalls":{output:()=>r},"ai.response.id":ae.id,"ai.response.model":ae.modelId,"ai.response.timestamp":ae.timestamp.toISOString(),"ai.usage.promptTokens":Q.promptTokens,"ai.usage.completionTokens":Q.completionTokens,"gen_ai.response.finish_reasons":[K],"gen_ai.response.id":ae.id,"gen_ai.response.model":ae.modelId,"gen_ai.usage.input_tokens":Q.promptTokens,"gen_ai.usage.output_tokens":Q.completionTokens}}))}catch(e){}finally{$.end()}e.enqueue({type:"step-finish",finishReason:K,usage:Q,providerMetadata:z,experimental_providerMetadata:z,logprobs:J,request:F,response:{...ae,headers:null==P?void 0:P.headers},warnings:j,isContinued:"continue"===a,messageId:I});const s=ji(p,Q);if("done"===a)e.enqueue({type:"finish",finishReason:K,usage:s,providerMetadata:z,experimental_providerMetadata:z,logprobs:J,response:{...ae,headers:null==P?void 0:P.headers}}),X.closeStream();else{if("continue"===k){const e=l[l.length-1];"string"==typeof e.content?e.content+=te:e.content.push({text:te,type:"text"})}else l.push(...gl({text:te,files:B,reasoning:U,tools:null!=u?u:{},toolCalls:q,toolResults:L,messageId:I,generateMessageId:w}));await n({currentStep:i+1,responseMessages:l,usage:s,stepType:a,previousStepText:re,hasLeadingWhitespace:ie,messageId:"continue"===a?I:w()})}}})))}({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:w()})}}).catch((e=>{X.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),X.closeStream()}))}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return Pi(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.textDelta)}})))}get fullStream(){return Pi(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(){const e=this.fullStream;for await(const t of e);}get experimental_partialOutputStream(){if(null==this.output)throw new Ui;return Pi(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:r=!1,sendSources:a=!1,experimental_sendFinish:n=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(s,o)=>{const i=s.type;switch(i){case"text-delta":o.enqueue(ao("text",s.textDelta));break;case"reasoning":r&&o.enqueue(ao("reasoning",s.textDelta));break;case"redacted-reasoning":r&&o.enqueue(ao("redacted_reasoning",{data:s.data}));break;case"reasoning-signature":r&&o.enqueue(ao("reasoning_signature",{signature:s.signature}));break;case"file":o.enqueue(ao("file",{mimeType:s.mimeType,data:s.base64}));break;case"source":a&&o.enqueue(ao("source",s.source));break;case"tool-call-streaming-start":o.enqueue(ao("tool_call_streaming_start",{toolCallId:s.toolCallId,toolName:s.toolName}));break;case"tool-call-delta":o.enqueue(ao("tool_call_delta",{toolCallId:s.toolCallId,argsTextDelta:s.argsTextDelta}));break;case"tool-call":o.enqueue(ao("tool_call",{toolCallId:s.toolCallId,toolName:s.toolName,args:s.args}));break;case"tool-result":o.enqueue(ao("tool_result",{toolCallId:s.toolCallId,result:s.result}));break;case"error":o.enqueue(ao("error",e(s.error)));break;case"step-start":o.enqueue(ao("start_step",{messageId:s.messageId}));break;case"step-finish":o.enqueue(ao("finish_step",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0,isContinued:s.isContinued}));break;case"finish":n&&o.enqueue(ao("finish_message",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0}));break;default:throw new Error(`Unknown chunk type: ${i}`)}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:a,data:n,getErrorMessage:s,sendUsage:o,sendReasoning:i,sendSources:l,experimental_sendFinish:u}={}){co({response:e,status:t,statusText:r,headers:uo(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:n,getErrorMessage:s,sendUsage:o,sendReasoning:i,sendSources:l,experimental_sendFinish:u})})}pipeTextStreamToResponse(e,t){co({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:uo(null==t?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){const t=this.toDataStreamInternal({getErrorMessage:null==e?void 0:e.getErrorMessage,sendUsage:null==e?void 0:e.sendUsage,sendReasoning:null==e?void 0:e.sendReasoning,sendSources:null==e?void 0:e.sendSources,experimental_sendFinish:null==e?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return(null==e?void 0:e.data)?Nl(null==e?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:null==t?void 0:t.sendUsage,sendReasoning:null==t?void 0:t.sendReasoning,sendSources:null==t?void 0:t.sendSources,experimental_sendFinish:null==t?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:a,getErrorMessage:n,sendUsage:s,sendReasoning:o,sendSources:i,experimental_sendFinish:l}={}){return new Response(this.toDataStream({data:a,getErrorMessage:n,sendUsage:s,sendReasoning:o,sendSources:i,experimental_sendFinish:l}),{status:t,statusText:r,headers:lo(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:lo(null==e?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},$l=(Symbol.for("vercel.ai.error.AI_NoSuchProviderError"),Wr.object({name:Wr.string(),version:Wr.string()}).passthrough()),Zl=Wr.object({_meta:Wr.optional(Wr.object({}).passthrough())}).passthrough(),Dl=Zl,Fl=Wr.object({method:Wr.string(),params:Wr.optional(Zl)}),ql=Wr.object({experimental:Wr.optional(Wr.object({}).passthrough()),logging:Wr.optional(Wr.object({}).passthrough()),prompts:Wr.optional(Wr.object({listChanged:Wr.optional(Wr.boolean())}).passthrough()),resources:Wr.optional(Wr.object({subscribe:Wr.optional(Wr.boolean()),listChanged:Wr.optional(Wr.boolean())}).passthrough()),tools:Wr.optional(Wr.object({listChanged:Wr.optional(Wr.boolean())}).passthrough())}).passthrough(),Ll=(Dl.extend({protocolVersion:Wr.string(),capabilities:ql,serverInfo:$l,instructions:Wr.optional(Wr.string())}),Dl.extend({nextCursor:Wr.optional(Wr.string())})),Ul=Wr.object({name:Wr.string(),description:Wr.optional(Wr.string()),inputSchema:Wr.object({type:Wr.literal("object"),properties:Wr.optional(Wr.object({}).passthrough())}).passthrough()}).passthrough(),Bl=(Ll.extend({tools:Wr.array(Ul)}),Wr.object({type:Wr.literal("text"),text:Wr.string()}).passthrough()),Vl=Wr.object({type:Wr.literal("image"),data:Wr.string().base64(),mimeType:Wr.string()}).passthrough(),zl=Wr.object({uri:Wr.string(),mimeType:Wr.optional(Wr.string())}).passthrough(),Jl=zl.extend({text:Wr.string()}),Kl=zl.extend({blob:Wr.string().base64()}),Wl=Wr.object({type:Wr.literal("resource"),resource:Wr.union([Jl,Kl])}).passthrough(),Hl=(Dl.extend({content:Wr.array(Wr.union([Bl,Vl,Wl])),isError:Wr.boolean().default(!1).optional()}).or(Dl.extend({toolResult:Wr.unknown()})),"2.0"),Yl=Wr.object({jsonrpc:Wr.literal(Hl),id:Wr.union([Wr.string(),Wr.number().int()])}).merge(Fl).strict(),Gl=Wr.object({jsonrpc:Wr.literal(Hl),id:Wr.union([Wr.string(),Wr.number().int()]),result:Dl}).strict(),Xl=Wr.object({jsonrpc:Wr.literal(Hl),id:Wr.union([Wr.string(),Wr.number().int()]),error:Wr.object({code:Wr.number().int(),message:Wr.string(),data:Wr.optional(Wr.unknown())})}).strict(),Ql=Wr.object({jsonrpc:Wr.literal(Hl)}).merge(Wr.object({method:Wr.string(),params:Wr.optional(Zl)})).strict();function eu(e={}){const t=new TextEncoder;let r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,n){n.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&"string"==typeof a&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function tu(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;"string"!=typeof e?"event"in e?"on_chat_model_stream"===e.event&&su(null==(r=e.data)?void 0:r.chunk,t):su(e,t):t.enqueue(e)}})).pipeThrough(eu(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(ao("text",e))}}))}function ru(e,t){return tu(e,t).pipeThrough(new TextEncoderStream)}function au(e,t){var r;const a=tu(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),n=null==t?void 0:t.data,s=null==t?void 0:t.init,o=n?Nl(n.stream,a):a;return new Response(o,{status:null!=(r=null==s?void 0:s.status)?r:200,statusText:null==s?void 0:s.statusText,headers:lo(null==s?void 0:s.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function nu(e,t){t.dataStream.merge(tu(e,t.callbacks))}function su(e,t){if("string"==typeof e.content)t.enqueue(e.content);else{const r=e.content;for(const e of r)"text"===e.type&&t.enqueue(e.text)}}function ou(e,t){const r=function(){let e=!0;return t=>(e&&(t=t.trimStart())&&(e=!1),t)}();return(a=e[Symbol.asyncIterator](),new ReadableStream({async pull(e){try{const{value:t,done:r}=await a.next();r?e.close():e.enqueue(t)}catch(t){e.error(t)}},cancel(){}})).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(r(e.delta))}})).pipeThrough(eu(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(ao("text",e))}}));var a}function iu(e,t){return ou(e,t).pipeThrough(new TextEncoderStream)}function lu(e,t={}){var r;const{init:a,data:n,callbacks:s}=t,o=ou(e,s).pipeThrough(new TextEncoderStream),i=n?Nl(n.stream,o):o;return new Response(i,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:lo(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function uu(e,t){t.dataStream.merge(ou(e,t.callbacks))}return Wr.union([Yl,Ql,Gl,Xl]),io({},{mergeIntoDataStream:()=>nu,toDataStream:()=>ru,toDataStreamResponse:()=>au}),io({},{mergeIntoDataStream:()=>uu,toDataStream:()=>iu,toDataStreamResponse:()=>lu}),a})()));